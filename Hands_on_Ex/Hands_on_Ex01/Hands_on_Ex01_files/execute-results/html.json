{
  "hash": "2b818185b5e48bb59ad66f41247d1ab6",
  "result": {
    "markdown": "---\ntitle: \"Hands-on Exercise 1: Geospatial Data Science and Visualisation\"\ndate: \"13 November 2023\"\ndate-modified: \"last-modified\"\nformat: html\nexecute: \n  echo: true # all code chunks will appear\n  eval: true # all code chunks will run live\n  warning: false # do not display warning message\neditor: visual\n---\n\n\n# Overview\n\nThis is the first hands-on exercise for ISSS624 Applied Geospatial Analytics. The first step is creating this webpage, and the subsequent steps are in data wrangling and choropleth mapping.\n\n# 1. Getting Started\n\n## 1.1. Webpage Creation\n\nThis webpage is created on RStudio using the quarto package. The package is installed using the following steps:\n\n> On RStudio \\> Tools \\> Install Packages \\> Type \"quarto\" in Packages field \\> Install to R/R-4.3.2/library\n\n## 1.2. Data Acquisition\n\nFor this Hands-on Exercise, the following data sets are assembled from the sources as indicated:\n\n| S/N | Name of Data Set                             | File type | Source                                                                                                                  | Extracted to (file directory) |\n|-----|----------------------------------------------|-----------|-------------------------------------------------------------------------------------------------------------------------|-------------------------------|\n| 1   | Master Plan 2014 Subzone Boundary (Web)      | SHP       | [data.gov.sg](https://data.gov.sg/)                                                                                     | /data/geospatial              |\n| 2   | Pre-Schools Location                         | KML       | [data.gov.sg](https://data.gov.sg/)                                                                                     | /data/geospatial              |\n| 3   | Cycling Path                                 | SHP       | [LTA DataMall](https://www.mytransport.sg/content/mytransport/home/dataMall.html)                                       | /data/geospatial              |\n| 4   | Singapore Listings                           | CSV       | [Inside Airbnb](http://insideairbnb.com/get-the-data.html)                                                              | /data/aspatial                |\n| 5   | Singapore Residents by Planning Area/Subzone | CSV       | [singstat.gov.sg](https://www.singstat.gov.sg/find-data/search-by-theme/population/geographic-distribution/latest-data) | /data/aspatial                |\n\n# 2. Geospatial Data Wrangling\n\nIn this Hands-on Exercise, the following R packages will be used:\n\n-   `sf` for importing, managing, and processing geospatial data;\n\n-   `tidyverse` to perform data science tasks such as importing, wrangling, and visualising data.\n\nWe will import the packages using the following code:\n\n\n::: {.cell}\n\n```{.r .cell-code}\npacman::p_load(sf,tidyverse)\n```\n:::\n\n\n## 2.1. Importing Geospatial Data\n\nWe will use the `st_read()` function from the `sf` package to import the following Geospatial data:\n\n| S/N | Name of Data Set                        | Format | Layer                 |\n|-----|-----------------------------------------|--------|-----------------------|\n| 1   | Master Plan 2014 Subzone Boundary (Web) | SHP    | Polygon feature layer |\n| 2   | Pre-Schools Location                    | SHP    | Line feature layer    |\n| 3   | Cycling Path                            | KML    | Point feature layer   |\n\n### 2.1.1. Import Polygon Feature Data\n\nUsing the code below, we will import `MP14_SUBZONE_WEB_PL` shapefile into R as a polygon feature data frame. As the input geospatial data is in shapefile format, two arguments will be used:\n\n1.  `dsn` to define the data path\n\n2.  `layer` to provide the shapefile name\n\n\n::: {.cell}\n\n```{.r .cell-code}\nmpsz = st_read(dsn = \"data/geospatial\",\n               layer = \"MP14_SUBZONE_WEB_PL\")\n```\n\n::: {.cell-output .cell-output-stdout}\n```\nReading layer `MP14_SUBZONE_WEB_PL' from data source \n  `C:\\Users\\noel1\\Documents\\School\\02. Special Sem 1\\ISSS624 Geospatial Analysis\\noelnomel\\ISSS624\\Hands_on_Ex\\Hands_on_Ex01\\data\\geospatial' \n  using driver `ESRI Shapefile'\nSimple feature collection with 323 features and 15 fields\nGeometry type: MULTIPOLYGON\nDimension:     XY\nBounding box:  xmin: 2667.538 ymin: 15748.72 xmax: 56396.44 ymax: 50256.33\nProjected CRS: SVY21\n```\n:::\n:::\n\n\n> As the dataset is in SHP format, the file extensions (.shp, .dbf, .prj, and .sbn) need not be included.\n\nRunning the code shows that there are [323 multipolygon features]{.underline} and [15 fields]{.underline} in the `mpsz` simple feature data frame. The `mpsz` data frame is using the **SVY21** projected coordinates system.\n\n### 2.1.2. Import Line Feature Data\n\nSimilarly, we will use the following code with the same arguments to import `CyclingPath` shapefile into R as a line feature data frame.\n\n\n::: {.cell}\n\n```{.r .cell-code}\ncyclingpath = st_read(dsn = \"data/geospatial\",\n               layer = \"CyclingPathGazette\")\n```\n\n::: {.cell-output .cell-output-stdout}\n```\nReading layer `CyclingPathGazette' from data source \n  `C:\\Users\\noel1\\Documents\\School\\02. Special Sem 1\\ISSS624 Geospatial Analysis\\noelnomel\\ISSS624\\Hands_on_Ex\\Hands_on_Ex01\\data\\geospatial' \n  using driver `ESRI Shapefile'\nSimple feature collection with 2558 features and 2 fields\nGeometry type: MULTILINESTRING\nDimension:     XY\nBounding box:  xmin: 11854.32 ymin: 28347.98 xmax: 42626.09 ymax: 48948.15\nProjected CRS: SVY21\n```\n:::\n:::\n\n\nRunning the code shows that there are [2558 linestring features]{.underline} and [2 fields]{.underline} in the `cyclingpath` linestring feature data frame, which is also using the **SVY21** projected coordinates system.\n\n### 2.1.3. Import Point Feature Data\n\nThe following code is used to import the PreSchoolsLocation file. As the data is in KML format, the full filepath has to be provided:\n\n\n::: {.cell}\n\n```{.r .cell-code}\npreschools = st_read(dsn = \"data/geospatial/PreSchoolsLocation.kml\")\n```\n\n::: {.cell-output .cell-output-stdout}\n```\nReading layer `PRESCHOOLS_LOCATION' from data source \n  `C:\\Users\\noel1\\Documents\\School\\02. Special Sem 1\\ISSS624 Geospatial Analysis\\noelnomel\\ISSS624\\Hands_on_Ex\\Hands_on_Ex01\\data\\geospatial\\PreSchoolsLocation.kml' \n  using driver `KML'\nSimple feature collection with 2290 features and 2 fields\nGeometry type: POINT\nDimension:     XYZ\nBounding box:  xmin: 103.6878 ymin: 1.247759 xmax: 103.9897 ymax: 1.462134\nz_range:       zmin: 0 zmax: 0\nGeodetic CRS:  WGS 84\n```\n:::\n:::\n\n\n> As the full filepath is defined, we need not indicate the layer to be imported in the code.\n\nRunning the code shows that there are [2290 point features]{.underline} and [2 fields]{.underline} in the `preschools` point feature data frame. The preschools data frame is using the **WGS84** coordinates system.\n\n## 2.2. Checking the Contents of a Simple Feature data frame\n\nThere are different ways to have a quick view of the contents of a simple feature data frame. In this section, we will explore the following methods:\n\n1.  `st_geometry()`\n2.  `glimpse()`\n3.  `head()`\n\n### 2.2.1. Using `st_geometry()`\n\n`st_geometry` returns an object of class sfc, a list-column with geometries.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nst_geometry(mpsz)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\nGeometry set for 323 features \nGeometry type: MULTIPOLYGON\nDimension:     XY\nBounding box:  xmin: 2667.538 ymin: 15748.72 xmax: 56396.44 ymax: 50256.33\nProjected CRS: SVY21\nFirst 5 geometries:\n```\n:::\n:::\n\n\nRunning the code above shows minimal information about the feature, such as the geometry type, bounding box, and the coordinate system of the data. The first 5 geometries are also displayed.\n\n### 2.2.2. Using `glimpse()`\n\nUsing glimpse() allows us to see all columns of the data (but displayed in rows) and the type of data stored in field. The values in each column are also displayed following each column header.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nglimpse(mpsz)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\nRows: 323\nColumns: 16\n$ OBJECTID   <int> 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16, 17, …\n$ SUBZONE_NO <int> 1, 1, 3, 8, 3, 7, 9, 2, 13, 7, 12, 6, 1, 5, 1, 1, 3, 2, 2, …\n$ SUBZONE_N  <chr> \"MARINA SOUTH\", \"PEARL'S HILL\", \"BOAT QUAY\", \"HENDERSON HIL…\n$ SUBZONE_C  <chr> \"MSSZ01\", \"OTSZ01\", \"SRSZ03\", \"BMSZ08\", \"BMSZ03\", \"BMSZ07\",…\n$ CA_IND     <chr> \"Y\", \"Y\", \"Y\", \"N\", \"N\", \"N\", \"N\", \"Y\", \"N\", \"N\", \"N\", \"N\",…\n$ PLN_AREA_N <chr> \"MARINA SOUTH\", \"OUTRAM\", \"SINGAPORE RIVER\", \"BUKIT MERAH\",…\n$ PLN_AREA_C <chr> \"MS\", \"OT\", \"SR\", \"BM\", \"BM\", \"BM\", \"BM\", \"SR\", \"QT\", \"QT\",…\n$ REGION_N   <chr> \"CENTRAL REGION\", \"CENTRAL REGION\", \"CENTRAL REGION\", \"CENT…\n$ REGION_C   <chr> \"CR\", \"CR\", \"CR\", \"CR\", \"CR\", \"CR\", \"CR\", \"CR\", \"CR\", \"CR\",…\n$ INC_CRC    <chr> \"5ED7EB253F99252E\", \"8C7149B9EB32EEFC\", \"C35FEFF02B13E0E5\",…\n$ FMEL_UPD_D <date> 2014-12-05, 2014-12-05, 2014-12-05, 2014-12-05, 2014-12-05…\n$ X_ADDR     <dbl> 31595.84, 28679.06, 29654.96, 26782.83, 26201.96, 25358.82,…\n$ Y_ADDR     <dbl> 29220.19, 29782.05, 29974.66, 29933.77, 30005.70, 29991.38,…\n$ SHAPE_Leng <dbl> 5267.381, 3506.107, 1740.926, 3313.625, 2825.594, 4428.913,…\n$ SHAPE_Area <dbl> 1630379.27, 559816.25, 160807.50, 595428.89, 387429.44, 103…\n$ geometry   <MULTIPOLYGON [m]> MULTIPOLYGON (((31495.56 30..., MULTIPOLYGON (…\n```\n:::\n:::\n\n\nRunning the code above shows that `FMEL_UPD_D` is in **date** data type, while `X_ADDR`, `Y_ADDR`, `SHAPE_Leng`, and `SHAPE_Area` are in **double-precision** values.\n\n### 2.2.3. Using `head()`\n\nUsing `head()` shows the first `n` records to display for each field, while also displaying information regarding the geometric features.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nhead(mpsz, n=5)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\nSimple feature collection with 5 features and 15 fields\nGeometry type: MULTIPOLYGON\nDimension:     XY\nBounding box:  xmin: 25867.68 ymin: 28369.47 xmax: 32362.39 ymax: 30435.54\nProjected CRS: SVY21\n  OBJECTID SUBZONE_NO      SUBZONE_N SUBZONE_C CA_IND      PLN_AREA_N\n1        1          1   MARINA SOUTH    MSSZ01      Y    MARINA SOUTH\n2        2          1   PEARL'S HILL    OTSZ01      Y          OUTRAM\n3        3          3      BOAT QUAY    SRSZ03      Y SINGAPORE RIVER\n4        4          8 HENDERSON HILL    BMSZ08      N     BUKIT MERAH\n5        5          3        REDHILL    BMSZ03      N     BUKIT MERAH\n  PLN_AREA_C       REGION_N REGION_C          INC_CRC FMEL_UPD_D   X_ADDR\n1         MS CENTRAL REGION       CR 5ED7EB253F99252E 2014-12-05 31595.84\n2         OT CENTRAL REGION       CR 8C7149B9EB32EEFC 2014-12-05 28679.06\n3         SR CENTRAL REGION       CR C35FEFF02B13E0E5 2014-12-05 29654.96\n4         BM CENTRAL REGION       CR 3775D82C5DDBEFBD 2014-12-05 26782.83\n5         BM CENTRAL REGION       CR 85D9ABEF0A40678F 2014-12-05 26201.96\n    Y_ADDR SHAPE_Leng SHAPE_Area                       geometry\n1 29220.19   5267.381  1630379.3 MULTIPOLYGON (((31495.56 30...\n2 29782.05   3506.107   559816.2 MULTIPOLYGON (((29092.28 30...\n3 29974.66   1740.926   160807.5 MULTIPOLYGON (((29932.33 29...\n4 29933.77   3313.625   595428.9 MULTIPOLYGON (((27131.28 30...\n5 30005.70   2825.594   387429.4 MULTIPOLYGON (((26451.03 30...\n```\n:::\n:::\n\n\nRunning the code above displayed information on the geometric features and the first 5 records in the data set.\n\n## 2.3. Plotting the Geospatial Data\n\nWe will use the plot() function to visualise the geospatial features.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nplot(mpsz)\n```\n\n::: {.cell-output-display}\n![](Hands_on_Ex01_files/figure-html/unnamed-chunk-8-1.png){width=672}\n:::\n:::\n\n\n> The default plot of an `sf` object is a multi-plot of all attributes, up to a reasonable maximum.\n\nWe can choose to plot only the geometry as shown below:\n\n\n::: {.cell}\n\n```{.r .cell-code}\nplot(st_geometry(mpsz))\n```\n\n::: {.cell-output-display}\n![](Hands_on_Ex01_files/figure-html/unnamed-chunk-9-1.png){width=672}\n:::\n:::\n\n\nWe can also choose to plot the sf object using a specific attribute:\n\n\n::: {.cell}\n\n```{.r .cell-code}\nplot(mpsz[\"PLN_AREA_N\"])\n```\n\n::: {.cell-output-display}\n![](Hands_on_Ex01_files/figure-html/unnamed-chunk-10-1.png){width=672}\n:::\n:::\n\n\n## 2.4. Projection Transformation\n\nIn order to perform geoprocessing using two different geospatial data sets, both data sets should be projected using similar coordinate systems.\n\nWe will conduct projection transformation to project a simple feature data frame from one coordinate system to another.\n\n### 2.4.1. Assigning EPSG Code to Simple Feature Data Frame\n\nOne common issue that happens when geospatial data is imported into R is that the coordinate system of the source data is wrongly assigned during import.\n\nFor example, examining the `mpsz` simple feature data frame using `st_crs()` shows that:\n\n\n::: {.cell}\n\n```{.r .cell-code}\nst_crs(mpsz)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\nCoordinate Reference System:\n  User input: SVY21 \n  wkt:\nPROJCRS[\"SVY21\",\n    BASEGEOGCRS[\"SVY21[WGS84]\",\n        DATUM[\"World Geodetic System 1984\",\n            ELLIPSOID[\"WGS 84\",6378137,298.257223563,\n                LENGTHUNIT[\"metre\",1]],\n            ID[\"EPSG\",6326]],\n        PRIMEM[\"Greenwich\",0,\n            ANGLEUNIT[\"Degree\",0.0174532925199433]]],\n    CONVERSION[\"unnamed\",\n        METHOD[\"Transverse Mercator\",\n            ID[\"EPSG\",9807]],\n        PARAMETER[\"Latitude of natural origin\",1.36666666666667,\n            ANGLEUNIT[\"Degree\",0.0174532925199433],\n            ID[\"EPSG\",8801]],\n        PARAMETER[\"Longitude of natural origin\",103.833333333333,\n            ANGLEUNIT[\"Degree\",0.0174532925199433],\n            ID[\"EPSG\",8802]],\n        PARAMETER[\"Scale factor at natural origin\",1,\n            SCALEUNIT[\"unity\",1],\n            ID[\"EPSG\",8805]],\n        PARAMETER[\"False easting\",28001.642,\n            LENGTHUNIT[\"metre\",1],\n            ID[\"EPSG\",8806]],\n        PARAMETER[\"False northing\",38744.572,\n            LENGTHUNIT[\"metre\",1],\n            ID[\"EPSG\",8807]]],\n    CS[Cartesian,2],\n        AXIS[\"(E)\",east,\n            ORDER[1],\n            LENGTHUNIT[\"metre\",1,\n                ID[\"EPSG\",9001]]],\n        AXIS[\"(N)\",north,\n            ORDER[2],\n            LENGTHUNIT[\"metre\",1,\n                ID[\"EPSG\",9001]]]]\n```\n:::\n:::\n\n\nThe `mpsz` data frame is projected to SVY21 but the code above reveals that EPSG is 9001 when the correct EPSG code for SVY21 is **3414**.\n\nWe will use `st_set_crs()` from the `sf` package to assign EPSG code **3414** to the `mpsz` data frame.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nmpsz3414 <- st_set_crs(mpsz,3414)\n```\n:::\n\n\nNow to confirm that `mpsz3414` is assigned the correct EPSG code, we will run the following code, which shows the EPSG code as 3414.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nst_crs(mpsz3414)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\nCoordinate Reference System:\n  User input: EPSG:3414 \n  wkt:\nPROJCRS[\"SVY21 / Singapore TM\",\n    BASEGEOGCRS[\"SVY21\",\n        DATUM[\"SVY21\",\n            ELLIPSOID[\"WGS 84\",6378137,298.257223563,\n                LENGTHUNIT[\"metre\",1]]],\n        PRIMEM[\"Greenwich\",0,\n            ANGLEUNIT[\"degree\",0.0174532925199433]],\n        ID[\"EPSG\",4757]],\n    CONVERSION[\"Singapore Transverse Mercator\",\n        METHOD[\"Transverse Mercator\",\n            ID[\"EPSG\",9807]],\n        PARAMETER[\"Latitude of natural origin\",1.36666666666667,\n            ANGLEUNIT[\"degree\",0.0174532925199433],\n            ID[\"EPSG\",8801]],\n        PARAMETER[\"Longitude of natural origin\",103.833333333333,\n            ANGLEUNIT[\"degree\",0.0174532925199433],\n            ID[\"EPSG\",8802]],\n        PARAMETER[\"Scale factor at natural origin\",1,\n            SCALEUNIT[\"unity\",1],\n            ID[\"EPSG\",8805]],\n        PARAMETER[\"False easting\",28001.642,\n            LENGTHUNIT[\"metre\",1],\n            ID[\"EPSG\",8806]],\n        PARAMETER[\"False northing\",38744.572,\n            LENGTHUNIT[\"metre\",1],\n            ID[\"EPSG\",8807]]],\n    CS[Cartesian,2],\n        AXIS[\"northing (N)\",north,\n            ORDER[1],\n            LENGTHUNIT[\"metre\",1]],\n        AXIS[\"easting (E)\",east,\n            ORDER[2],\n            LENGTHUNIT[\"metre\",1]],\n    USAGE[\n        SCOPE[\"Cadastre, engineering survey, topographic mapping.\"],\n        AREA[\"Singapore - onshore and offshore.\"],\n        BBOX[1.13,103.59,1.47,104.07]],\n    ID[\"EPSG\",3414]]\n```\n:::\n:::\n\n\n### 2.4.2. Transform Projection of `preschools` from WGS84 to SVY21\n\nAs geographic coordinate system is not appropriate for use with analysis that requires distance and/or area measurements, it may be necessary to transform such data to projected coordinate system.\n\nFor example, the `preschools` simple feature data frame is using **WGS84** geographic coordinate system.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nst_geometry(preschools)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\nGeometry set for 2290 features \nGeometry type: POINT\nDimension:     XYZ\nBounding box:  xmin: 103.6878 ymin: 1.247759 xmax: 103.9897 ymax: 1.462134\nz_range:       zmin: 0 zmax: 0\nGeodetic CRS:  WGS 84\nFirst 5 geometries:\n```\n:::\n:::\n\n\nWe will have to *reproject* `preschools` from the existing system to **SVY21** mathematically, which can be achieved through `st_transform()`. `st_set_crs()` only replaces the crs and does not reproject the data.\n\n\n::: {.cell}\n\n```{.r .cell-code}\npreschools3414 <- st_transform(preschools,crs=3414)\n```\n:::\n\n\nNow to confirm that `preschools3414` is using the SVY21 system, we will run the following code:\n\n\n::: {.cell}\n\n```{.r .cell-code}\nst_geometry(preschools3414)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\nGeometry set for 2290 features \nGeometry type: POINT\nDimension:     XYZ\nBounding box:  xmin: 11810.03 ymin: 25596.33 xmax: 45404.24 ymax: 49300.88\nz_range:       zmin: 0 zmax: 0\nProjected CRS: SVY21 / Singapore TM\nFirst 5 geometries:\n```\n:::\n:::\n\n\nIt can be observed that preschools3414 is now using SVY21. Furthermore, it can be observed that the values in Bounding box are greater than the decimal degree range of 0 to 360 commonly used by many geographic coordinate systems.\n\n## 2.5. Importing and Converting Aspatial Data\n\n### 2.5.1. Importing Aspatial Data\n\nThe `listings.csv` file downloaded from [Inside Airbnb]{.underline} is a aspatial dataset as it does not contain geospatial data but it has fields that capture the x- and y-coordinates of the data points.\n\nWe will import the CSV file into R, save it as a tibble data frame, before converting it to a simple feature data frame.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlistings <- read_csv(\"data/aspatial/listings.csv\")\n```\n:::\n\n\nWe will use the following code to examine if the data file was imported correctly:\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlist(listings)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n[[1]]\n# A tibble: 3,483 × 75\n       id listing_url            scrape_id last_scraped source name  description\n    <dbl> <chr>                      <dbl> <date>       <chr>  <chr> <chr>      \n 1  71609 https://www.airbnb.co…   2.02e13 2023-09-23   previ… Vill… For 3 room…\n 2  71896 https://www.airbnb.co…   2.02e13 2023-09-23   previ… Home… <b>The spa…\n 3  71903 https://www.airbnb.co…   2.02e13 2023-09-23   previ… Home… Like your …\n 4 275343 https://www.airbnb.co…   2.02e13 2023-09-23   city … Rent… **IMPORTAN…\n 5 275344 https://www.airbnb.co…   2.02e13 2023-09-23   city … Rent… Lovely hom…\n 6 289234 https://www.airbnb.co…   2.02e13 2023-09-23   previ… Home… This whole…\n 7 294281 https://www.airbnb.co…   2.02e13 2023-09-23   city … Rent… I have 3 b…\n 8 324945 https://www.airbnb.co…   2.02e13 2023-09-23   city … Rent… **IMPORTAN…\n 9 330095 https://www.airbnb.co…   2.02e13 2023-09-23   city … Rent… **IMPORTAN…\n10 369141 https://www.airbnb.co…   2.02e13 2023-09-23   city … Plac… A room in …\n# ℹ 3,473 more rows\n# ℹ 68 more variables: neighborhood_overview <chr>, picture_url <chr>,\n#   host_id <dbl>, host_url <chr>, host_name <chr>, host_since <date>,\n#   host_location <chr>, host_about <chr>, host_response_time <chr>,\n#   host_response_rate <chr>, host_acceptance_rate <chr>,\n#   host_is_superhost <lgl>, host_thumbnail_url <chr>, host_picture_url <chr>,\n#   host_neighbourhood <chr>, host_listings_count <dbl>, …\n```\n:::\n:::\n\n\nThe output shows that the `listings` tibble data frame consists of [3,483 records and 75 columns]{.underline}. The `latitude` and `longitude` fields will be used for the next step. It is observed that both fields are in decimal degree format; we could guess that the data is using **WGS84** geographic coordinate system.\n\n### 2.5.2. Converting Aspatial Data\n\nWe will use the `st_as_sf()` function from the `sf` package to convert `listings` tibble data into a simple feature data frame.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlistings_sf <- st_as_sf(listings, \n                        coords = c(\"longitude\",\"latitude\"),\n                        crs=4326) %>%\n  st_transform(crs=3414)\n```\n:::\n\n\n> the `coords` argument takes x-coordinates followed by y-coordinates\n>\n> EPSG 4326 refers to the WSG84 geographic coordinate system\n>\n> `%>%` is used to nest `st_transform()` to reproject the newly created simple feature data frame into SVY21 projected coordinate system.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nglimpse(listings_sf)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\nRows: 3,483\nColumns: 74\n$ id                                           <dbl> 71609, 71896, 71903, 2753…\n$ listing_url                                  <chr> \"https://www.airbnb.com/r…\n$ scrape_id                                    <dbl> 2.023092e+13, 2.023092e+1…\n$ last_scraped                                 <date> 2023-09-23, 2023-09-23, …\n$ source                                       <chr> \"previous scrape\", \"previ…\n$ name                                         <chr> \"Villa in Singapore · ★4.…\n$ description                                  <chr> \"For 3 rooms.Book room 1&…\n$ neighborhood_overview                        <chr> NA, NA, \"Quiet and view o…\n$ picture_url                                  <chr> \"https://a0.muscache.com/…\n$ host_id                                      <dbl> 367042, 367042, 367042, 1…\n$ host_url                                     <chr> \"https://www.airbnb.com/u…\n$ host_name                                    <chr> \"Belinda\", \"Belinda\", \"Be…\n$ host_since                                   <date> 2011-01-29, 2011-01-29, …\n$ host_location                                <chr> \"Singapore\", \"Singapore\",…\n$ host_about                                   <chr> \"Hi My name is Belinda -H…\n$ host_response_time                           <chr> \"within a few hours\", \"wi…\n$ host_response_rate                           <chr> \"100%\", \"100%\", \"100%\", \"…\n$ host_acceptance_rate                         <chr> \"100%\", \"100%\", \"100%\", \"…\n$ host_is_superhost                            <lgl> FALSE, FALSE, FALSE, FALS…\n$ host_thumbnail_url                           <chr> \"https://a0.muscache.com/…\n$ host_picture_url                             <chr> \"https://a0.muscache.com/…\n$ host_neighbourhood                           <chr> \"Tampines\", \"Tampines\", \"…\n$ host_listings_count                          <dbl> 5, 5, 5, 52, 52, 5, 7, 52…\n$ host_total_listings_count                    <dbl> 15, 15, 15, 65, 65, 15, 8…\n$ host_verifications                           <chr> \"['email', 'phone']\", \"['…\n$ host_has_profile_pic                         <lgl> TRUE, TRUE, TRUE, TRUE, T…\n$ host_identity_verified                       <lgl> TRUE, TRUE, TRUE, TRUE, T…\n$ neighbourhood                                <chr> NA, NA, \"Singapore, Singa…\n$ neighbourhood_cleansed                       <chr> \"Tampines\", \"Tampines\", \"…\n$ neighbourhood_group_cleansed                 <chr> \"East Region\", \"East Regi…\n$ property_type                                <chr> \"Private room in villa\", …\n$ room_type                                    <chr> \"Private room\", \"Private …\n$ accommodates                                 <dbl> 3, 1, 2, 1, 1, 4, 2, 1, 1…\n$ bathrooms                                    <lgl> NA, NA, NA, NA, NA, NA, N…\n$ bathrooms_text                               <chr> \"1 private bath\", \"Shared…\n$ bedrooms                                     <dbl> NA, NA, NA, NA, NA, 3, NA…\n$ beds                                         <dbl> 3, 1, 2, 1, 1, 5, 1, 1, 1…\n$ amenities                                    <chr> \"[\\\"Private backyard \\\\u2…\n$ price                                        <chr> \"$150.00\", \"$80.00\", \"$80…\n$ minimum_nights                               <dbl> 92, 92, 92, 60, 60, 92, 9…\n$ maximum_nights                               <dbl> 365, 365, 365, 999, 999, …\n$ minimum_minimum_nights                       <dbl> 92, 92, 92, 60, 60, 92, 9…\n$ maximum_minimum_nights                       <dbl> 92, 92, 92, 60, 60, 92, 9…\n$ minimum_maximum_nights                       <dbl> 1125, 1125, 1125, 1125, 1…\n$ maximum_maximum_nights                       <dbl> 1125, 1125, 1125, 1125, 1…\n$ minimum_nights_avg_ntm                       <dbl> 92, 92, 92, 60, 60, 92, 9…\n$ maximum_nights_avg_ntm                       <dbl> 1125, 1125, 1125, 1125, 1…\n$ calendar_updated                             <lgl> NA, NA, NA, NA, NA, NA, N…\n$ has_availability                             <lgl> TRUE, TRUE, TRUE, TRUE, T…\n$ availability_30                              <dbl> 28, 28, 28, 1, 30, 28, 30…\n$ availability_60                              <dbl> 58, 58, 58, 1, 60, 58, 60…\n$ availability_90                              <dbl> 88, 88, 88, 1, 90, 88, 90…\n$ availability_365                             <dbl> 89, 89, 89, 275, 274, 89,…\n$ calendar_last_scraped                        <date> 2023-09-23, 2023-09-23, …\n$ number_of_reviews                            <dbl> 20, 24, 47, 22, 17, 12, 1…\n$ number_of_reviews_ltm                        <dbl> 0, 0, 0, 0, 3, 0, 0, 1, 3…\n$ number_of_reviews_l30d                       <dbl> 0, 0, 0, 0, 0, 0, 0, 1, 1…\n$ first_review                                 <date> 2011-12-19, 2011-07-30, …\n$ last_review                                  <date> 2020-01-17, 2019-10-13, …\n$ review_scores_rating                         <dbl> 4.44, 4.16, 4.41, 4.40, 4…\n$ review_scores_accuracy                       <dbl> 4.37, 4.22, 4.39, 4.16, 4…\n$ review_scores_cleanliness                    <dbl> 4.00, 4.09, 4.52, 4.26, 4…\n$ review_scores_checkin                        <dbl> 4.63, 4.43, 4.63, 4.47, 4…\n$ review_scores_communication                  <dbl> 4.78, 4.43, 4.64, 4.42, 4…\n$ review_scores_location                       <dbl> 4.26, 4.17, 4.50, 4.53, 4…\n$ review_scores_value                          <dbl> 4.32, 4.04, 4.36, 4.63, 4…\n$ license                                      <chr> NA, NA, NA, \"S0399\", \"S03…\n$ instant_bookable                             <lgl> FALSE, FALSE, FALSE, TRUE…\n$ calculated_host_listings_count               <dbl> 5, 5, 5, 52, 52, 5, 7, 52…\n$ calculated_host_listings_count_entire_homes  <dbl> 0, 0, 0, 1, 1, 0, 1, 1, 1…\n$ calculated_host_listings_count_private_rooms <dbl> 5, 5, 5, 51, 51, 5, 6, 51…\n$ calculated_host_listings_count_shared_rooms  <dbl> 0, 0, 0, 0, 0, 0, 0, 0, 0…\n$ reviews_per_month                            <dbl> 0.14, 0.16, 0.31, 0.17, 0…\n$ geometry                                     <POINT [m]> POINT (41972.5 3639…\n```\n:::\n:::\n\n\nIt can be observed that a new column labelled `geometry` has been added while the `longitude` and `latitude` columns have been dropped from the listings_sf data frame.\n\n## 2.6. Geoprocessing with `sf` package\n\nIn addition to the functions explored above, the sf package also offers a wide range of geoprocessing functions, also called GIS analysis.\n\nWe will explore the use of buffering and point in polygon count in this section.\n\n### 2.6.1. Buffering\n\n*Scenario:*\n\nThe authorities are planning to upgrade existing cycling paths and they need to acquire 5 metres of reserved land on both sides of existing cycling paths. You are tasked to determine the extent of land that needs to be acquired and its total area.\n\nWe will derive the solution using `st_buffer()` to compute the 5-metre buffer around the current cycling paths.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nbuffer_cycling <- st_buffer(cyclingpath,dist=5, nQuadSegs = 30)\n```\n:::\n\n\nWe will then calculate the area of the buffers using this code:\n\n\n::: {.cell}\n\n```{.r .cell-code}\nbuffer_cycling$AREA <- st_area(buffer_cycling)\n```\n:::\n\n\nTo derive the total area of land involved in this plan, we will use the `sum()` function:\n\n\n::: {.cell}\n\n```{.r .cell-code}\nsum(buffer_cycling$AREA)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n1774367 [m^2]\n```\n:::\n:::\n\n\n### 2.6.2. Point-in-Polygon Count\n\n*Scenario:*\n\nYou are tasked to find out the number of pre-schools in each Planning Subzone.\n\nThis can be achieved by combining the `lengths()` function and the `st_intersects()` function as shown in the code below. The `st_instersects()` function identifies pre-schools located in each Planning Subzone while the `lengths()` function counts the number of pre-schools that are found in each Planning Subzone.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nmpsz3414$'PreSchools_Count' <- lengths(st_intersects(mpsz3414,preschools3414))\n```\n:::\n\n\n> `st_intersection()`: Returns a geometry representing the point-set intersection of two geometries. \n>\n> `st_intersects()`: Returns **`true`** if two geometries intersect (i.e. if they have any point in common).\n\nNext, we will check the summary statistics of the newly derived field using `summary()` as shown below:\n\n\n::: {.cell}\n\n```{.r .cell-code}\nsummary(mpsz3414$\"PreSchools_Count\")\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n   Min. 1st Qu.  Median    Mean 3rd Qu.    Max. \n   0.00    0.00    4.00    7.09   10.00   72.00 \n```\n:::\n:::\n\n\nWe will use `top_n()` from the `dplyr` package to display the Planning Subzone with the highest number of pre-schools:\n\n\n::: {.cell}\n\n```{.r .cell-code}\ntop_n(mpsz3414,1,PreSchools_Count)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\nSimple feature collection with 1 feature and 16 fields\nGeometry type: MULTIPOLYGON\nDimension:     XY\nBounding box:  xmin: 39655.33 ymin: 35966 xmax: 42940.57 ymax: 38622.37\nProjected CRS: SVY21 / Singapore TM\n  OBJECTID SUBZONE_NO     SUBZONE_N SUBZONE_C CA_IND PLN_AREA_N PLN_AREA_C\n1      189          2 TAMPINES EAST    TMSZ02      N   TAMPINES         TM\n     REGION_N REGION_C          INC_CRC FMEL_UPD_D   X_ADDR   Y_ADDR SHAPE_Leng\n1 EAST REGION       ER 21658EAAF84F4D8D 2014-12-05 41122.55 37392.39   10180.62\n  SHAPE_Area                       geometry PreSchools_Count\n1    4339824 MULTIPOLYGON (((42196.76 38...               72\n```\n:::\n:::\n\n\n### 2.6.3. Calculate Density\n\nScenario:\n\nYou are tasked to determine the density of pre-schools by Planning Subzone.\n\nWe can do this by first deriving the area of each Planning Subzone using `st_area()` from the `sf` package.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nmpsz3414$Area <- mpsz3414 %>%\n  st_area()\n```\n:::\n\n\nNext, we use the mutate() function from the dplyr package to compute the density:\n\n\n::: {.cell}\n\n```{.r .cell-code}\nmpsz3414 <- mpsz3414 %>%\n  mutate('PreSchools_Density' = PreSchools_Count/Area * 1000000)\n```\n:::\n\n\nLastly, we can check that the fields are computed correctly by displaying the top 2 Planning Subzones with the highest pre-school density.\n\n\n::: {.cell}\n\n```{.r .cell-code}\ntop_n(mpsz3414,2,PreSchools_Density)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\nSimple feature collection with 2 features and 18 fields\nGeometry type: MULTIPOLYGON\nDimension:     XY\nBounding box:  xmin: 26864.99 ymin: 28623.75 xmax: 29976.93 ymax: 45653.61\nProjected CRS: SVY21 / Singapore TM\n  OBJECTID SUBZONE_NO     SUBZONE_N SUBZONE_C CA_IND    PLN_AREA_N PLN_AREA_C\n1       27          8         CECIL    DTSZ08      Y DOWNTOWN CORE         DT\n2      278          3 MANDAI ESTATE    MDSZ03      N        MANDAI         MD\n        REGION_N REGION_C          INC_CRC FMEL_UPD_D  X_ADDR   Y_ADDR\n1 CENTRAL REGION       CR 65AA82AF6F4D925D 2014-12-05 29730.2 29011.33\n2   NORTH REGION       NR F6266F7368DBB9AB 2014-12-05 27082.7 45367.46\n  SHAPE_Leng SHAPE_Area                       geometry PreSchools_Count\n1   2116.095   196619.9 MULTIPOLYGON (((29808.18 28...                7\n2   1633.708   143137.9 MULTIPOLYGON (((27119.56 45...                5\n            Area PreSchools_Density\n1 196619.9 [m^2]   35.60169 [1/m^2]\n2 143137.9 [m^2]   34.93134 [1/m^2]\n```\n:::\n:::\n\n\n## 2.7. Exploratory Data Analysis (EDA)\n\nWe will explore the use of `ggplot2` functions to create functional statistical graphs from geospatial data for EDA purposes.\n\nFirstly, we will plot a histogram using the `hist()` function to reveal the distribution of `PreSchools_Density`:\n\n\n::: {.cell}\n\n```{.r .cell-code}\nhist(mpsz3414$PreSchools_Density)\n```\n\n::: {.cell-output-display}\n![](Hands_on_Ex01_files/figure-html/unnamed-chunk-30-1.png){width=672}\n:::\n:::\n\n\nUsing the hist() function is straightforward but it provides limited room for customisation of the plots. Next, we will explore using ggplot2 functions to plot a customisable histogram:\n\n\n::: {.cell}\n\n```{.r .cell-code}\nggplot(data = mpsz3414,\n       aes(x = as.numeric(PreSchools_Density)))+\n  geom_histogram(bins = 20, color = \"black\", fill = \"lightblue\")+\n  labs(title = \"Are pre-schools evenly distributed in Singapore?\",\n       subtitle = \"There are many planning subzones with only one pre-school; \\non the other hand, there are two planning subzones with at least 20 pre-schools\",\n       x = 'Pre-school Density (per km sq)',\n       y = 'Frequency')\n```\n\n::: {.cell-output-display}\n![](Hands_on_Ex01_files/figure-html/unnamed-chunk-31-1.png){width=672}\n:::\n:::\n\n\nNext, we will use ggplot2 functions to plot a scatterplot to show the relationship between PreSchools_Density and PreSchools_Count:\n\n\n::: {.cell}\n\n```{.r .cell-code}\nggplot(data = mpsz3414,\n       aes(y = PreSchools_Count,\n           x = as.numeric(PreSchools_Density))) +\n  geom_point(color = \"black\", fill = \"lightblue\") +\n  xlim(0,40) +\n  ylim(0,40) +\n  labs(title = \"Is there a relationship between PreSchools_Density and PreSchools_Count?\",\n       x = 'Pre-school Density (per km sq)',\n       y = 'Pre-School Count')\n```\n\n::: {.cell-output-display}\n![](Hands_on_Ex01_files/figure-html/unnamed-chunk-32-1.png){width=672}\n:::\n:::\n\n\n# 3. Choropleth Mapping with R\n\nIn this Hands-on Exercise, we will use the `tmap` package to conduct choropleth mapping. Choropleth map uses colours to represent statistical data on a geographic map.\n\nThe following R packages will be used:\n\n-   `tmap` for layer-based approach to creating thematic maps\n\n-   `sf` for handling geospatial data;\n\n-   `tidyverse` to perform data science tasks such as importing, wrangling, and visualising data (includes `readr`, `tidyr`, `dplyr`packages)\n\nWe will import the packages using the following code:\n\n\n::: {.cell}\n\n```{.r .cell-code}\npacman::p_load(tmap, sf, tidyverse)\n```\n:::\n\n\n## 3.1. Importing and Preparing Attribute Data\n\n### 3.1.1. Importing Attribute Data\n\nIn addition to the data sets imported in the previous sections, we will now import the `respopagesex2011to2020.csv` file into Rstudio. This can be done using the `read_csv()` function from the `readr` package.\n\n\n::: {.cell}\n\n```{.r .cell-code}\npopdata <- read_csv(\"data/aspatial/respopagesextod2011to2020.csv\")\n```\n:::\n\n\n### 3.1.2. Preparing Attribute Data\n\nWe will now prepare a data table from popdata with values from year 2020. The data table should include PA, SZ and AG, and the following breakdown by AG will be used:\n\n-   YOUNG: from AG 0-4 to AG 20-24\n\n-   ECON ACTIVE: from AG 25-29 to AG 60-64\n\n-   AGED: from AG 65 and above\n\n-   TOTAL: all age groups\n\n-   DEPENDENCY: ratio between YOUNG + AGED and ECON ACTIVE groups\n\n#### 3.1.2.1. Data Wrangling\n\nThe following functions and codes will be used to transform the data:\n\n-   `pivot_wider()` from the `tidyr` package\n\n-   `mutate()`, `filter()`, `group_by()`, and `select()` from the `dplyr` package\n\n\n::: {.cell}\n\n```{.r .cell-code}\npopdata2020 <- popdata %>%\n  filter(Time == 2020) %>%\n  group_by(PA, SZ, AG) %>%\n  summarise('POP' = sum(Pop)) %>%\n  ungroup() %>%\n  pivot_wider(names_from = AG,\n              values_from = POP) %>%\n  mutate('YOUNG' = rowSums(.[3:6])\n         + rowSums(.[12])) %>%\n  mutate('ECON_ACTIVE' = rowSums(.[7:11])\n         + rowSums(.[13:15])) %>%\n  mutate('AGED' = rowSums(.[16:21])) %>%\n  mutate('TOTAL' = rowSums(.[3:21])) %>%\n  mutate('DEPENDENCY' = (YOUNG + AGED) / ECON_ACTIVE) %>%\n  select('PA','SZ','YOUNG','ECON_ACTIVE','AGED','TOTAL','DEPENDENCY' )\n```\n:::\n\n\n#### 3.1.2.2. Joining Attribute and Geospatial Data\n\nThe data fields in both the Attribute and Geospatial data sets must be exactly the same before a georelational join can be performed. Hence, all `PA` and `SZ` fields in `popdata2020` must be first converted to uppercase to match the fields in `mpsz`.\n\n\n::: {.cell}\n\n```{.r .cell-code}\npopdata2020 <- popdata2020 %>%\n  mutate_at(.vars = vars(PA, SZ),\n            .funs = list(toupper)) %>%\n  filter('ECON_ACTIVE' > 0)\n```\n:::\n\n\nNext, we will use `left_join()` from the `dplyr` package to join `mpsz` and `pop2020` using `SUBZONE_N` and `SZ` as the identifier.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nmpsz_pop2020 <- left_join(mpsz, popdata2020,\n                          by = c(\"SUBZONE_N\" = \"SZ\"))\n```\n:::\n\n\n> `mpsz`, a simple feature data frame, is used as the **left data table** to keep the same format of the output table.\n\nThe newly created simple feature data frame is saved to the rds folder using `write_rds()`.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nwrite_rds(mpsz_pop2020,\"data/rds/mpszpop2020.rds\")\n```\n:::\n\n\n## 3.2 Choropleth Mapping using `tmap`\n\nThere are two ways to plot a thematic map using `tmap`:\n\n1.  Quick plot using `qtm()`\n\n2.  Customisable plot using `tmap` elements\n\n### 3.2.1. Quick Plot Using `qtm()`\n\nThe `qtm()` function from `tmap` is the fastest and easiest way to plot a choropleth map with less customisation options available.\n\n\n::: {.cell}\n\n```{.r .cell-code}\ntmap_mode(\"plot\")\nqtm(mpsz_pop2020, fill = \"DEPENDENCY\")\n```\n\n::: {.cell-output-display}\n![](Hands_on_Ex01_files/figure-html/unnamed-chunk-39-1.png){width=672}\n:::\n:::\n\n\n> We can use the `\"plot\"` option `tmap_mode()` to plot a static map or `\"view\"` option for an interactive mode.\n>\n> The `fill` argument is used to map the attribute.\n\n### 3.2.2. Customisable Plot Using `tmap` Elements\n\nTo draw a high quality choropleth map, `tmap`'s drawing elements can be used:\n\n\n::: {.cell}\n\n```{.r .cell-code}\ntm_shape(mpsz_pop2020) +\n  tm_fill(\"DEPENDENCY\",\n          style = 'quantile',\n          palette = 'Blues',\n          title = 'Dependency Ratio') +\n  tm_layout(main.title = \"Distribution of Dependency Ratio by Planning Subzone\",\n            main.title.position = \"center\",\n            main.title.size = 1.2,\n            legend.height = 0.45,\n            legend.width = 0.35,\n            frame = TRUE) +\n  tm_borders(alpha = 0.5) +\n  tm_compass(type = \"8star\", size = 2) +\n  tm_scale_bar() +\n  tm_grid(alpha = 0.2) +\n  tm_credits(\"Source: Planning Sub-zone boundary from Urban Redevelopment Authority\\n and population data from Department of Statistics\",\n             position = c('left','bottom'))\n```\n\n::: {.cell-output-display}\n![](Hands_on_Ex01_files/figure-html/unnamed-chunk-40-1.png){width=672}\n:::\n:::\n\n\n#### 3.2.2.1. Drawing a Base Map\n\nThe basic building block of tmap is tmap_shape() followed by one or more layer elements such as `tm_fill()` or `tm_polygons()`.\n\n\n::: {.cell}\n\n```{.r .cell-code}\ntm_shape(mpsz_pop2020) +\n  tm_polygons()\n```\n\n::: {.cell-output-display}\n![](Hands_on_Ex01_files/figure-html/unnamed-chunk-41-1.png){width=672}\n:::\n:::\n\n\n> `tm_shape()` is used to define the input data (`mpsz_pop2020`)\n>\n> `tm_polygons()` is used to draw the planning subzone polygons\n\n#### 3.2.2.2. Drawing a Choropleth Map Using `tm_polygons()`\n\nA target variable can be assigned to tm_polygons() to draw a choropleth map showing the geographical distribution:\n\n\n::: {.cell}\n\n```{.r .cell-code}\ntm_shape(mpsz_pop2020) +\n  tm_polygons(\"DEPENDENCY\")\n```\n\n::: {.cell-output-display}\n![](Hands_on_Ex01_files/figure-html/unnamed-chunk-42-1.png){width=672}\n:::\n:::\n\n\n> The default interval binning used is \"pretty\".\n>\n> The default colour scheme used is `Yl0rRd` from ColorBrewer.\n>\n> The default colour for missing values is grey.\n\n#### 3.2.2.3. Drawing a Choropleth Map Using `tm_fill()` and `tm_border()`\n\n`tm_polygons()` does the work of both `tm_fill()` and `tm_border()` in one step. `tm_fill()` fills the polygons using the default colour scheme and `tm_borders()` adds borders to the polygons:\n\n\n::: {.cell}\n\n```{.r .cell-code}\ntm_shape(mpsz_pop2020) +\n  tm_fill(\"DEPENDENCY\")\n```\n\n::: {.cell-output-display}\n![](Hands_on_Ex01_files/figure-html/unnamed-chunk-43-1.png){width=672}\n:::\n:::\n\n\nThe planning subzones are now shaded by its respective dependency ratio.\n\n\n::: {.cell}\n\n```{.r .cell-code}\ntm_shape(mpsz_pop2020) +\n  tm_fill(\"DEPENDENCY\") +\n  tm_borders(lwd = 0.1, alpha = 1)\n```\n\n::: {.cell-output-display}\n![](Hands_on_Ex01_files/figure-html/unnamed-chunk-44-1.png){width=672}\n:::\n:::\n\n\nNow, borders are added to the boundaries of each planning subzone.\n\n> `alpha` is used to define the transparency with 0 being totally transparent and 1 being totally opaque.\n>\n> `col` is used to define the border colour\n>\n> `lwd` is used to define the border line width, default is `1`\n>\n> `lty` is used to define the border line type, default is `'solid'`\n\n### 3.2.3. Data Classification Methods Using `tmap`\n\nMost choropleth maps employ methods of data classification, which is to take a large number of observations and group them into ranges or classes.\n\ntmap provides 10 classification methods: `fixed`, `sd`, `equal`, `pretty` (default), `quantile`, `kmeans`, `hclust`, `bclust`, `fisher`, and `jenks`.\n\n#### 3.2.3.1. Plotting Choropleth Maps with Built-in Classification Methods\n\nUsing sd classification method:\n\n\n::: {.cell}\n\n```{.r .cell-code}\ntm_shape(mpsz_pop2020) +\n  tm_fill(\"DEPENDENCY\",\n          n = 5,\n          style = \"sd\") + \n  tm_borders(alpha = 0.5)\n```\n\n::: {.cell-output-display}\n![](Hands_on_Ex01_files/figure-html/unnamed-chunk-45-1.png){width=672}\n:::\n:::\n\n\nUsing equal classification method:\n\n\n::: {.cell}\n\n```{.r .cell-code}\ntm_shape(mpsz_pop2020) +\n  tm_fill(\"DEPENDENCY\",\n          n = 5,\n          style = \"equal\") + \n  tm_borders(alpha = 0.5)\n```\n\n::: {.cell-output-display}\n![](Hands_on_Ex01_files/figure-html/unnamed-chunk-46-1.png){width=672}\n:::\n:::\n\n\nUsing quantile classification method:\n\n\n::: {.cell}\n\n```{.r .cell-code}\ntm_shape(mpsz_pop2020) +\n  tm_fill(\"DEPENDENCY\",\n          n = 5,\n          style = \"quantile\") + \n  tm_borders(alpha = 0.5)\n```\n\n::: {.cell-output-display}\n![](Hands_on_Ex01_files/figure-html/unnamed-chunk-47-1.png){width=672}\n:::\n:::\n\n\nUsing kmeans classification method:\n\n\n::: {.cell}\n\n```{.r .cell-code}\ntm_shape(mpsz_pop2020) +\n  tm_fill(\"DEPENDENCY\",\n          n = 5,\n          style = \"kmeans\") + \n  tm_borders(alpha = 0.5)\n```\n\n::: {.cell-output-display}\n![](Hands_on_Ex01_files/figure-html/unnamed-chunk-48-1.png){width=672}\n:::\n:::\n\n\nUsing hclust classification method:\n\n\n::: {.cell}\n\n```{.r .cell-code}\ntm_shape(mpsz_pop2020) +\n  tm_fill(\"DEPENDENCY\",\n          n = 5,\n          style = \"hclust\") + \n  tm_borders(alpha = 0.5)\n```\n\n::: {.cell-output-display}\n![](Hands_on_Ex01_files/figure-html/unnamed-chunk-49-1.png){width=672}\n:::\n:::\n\n\nUsing bclust classification method:\n\n\n::: {.cell}\n\n```{.r .cell-code}\ntm_shape(mpsz_pop2020) +\n  tm_fill(\"DEPENDENCY\",\n          n = 5,\n          style = \"bclust\") + \n  tm_borders(alpha = 0.5)\n```\n\n::: {.cell-output-display}\n![](Hands_on_Ex01_files/figure-html/unnamed-chunk-50-1.png){width=672}\n:::\n\n::: {.cell-output .cell-output-stdout}\n```\nCommittee Member: 1(1) 2(1) 3(1) 4(1) 5(1) 6(1) 7(1) 8(1) 9(1) 10(1)\nComputing Hierarchical Clustering\n```\n:::\n:::\n\n\nUsing fisher classification method:\n\n\n::: {.cell}\n\n```{.r .cell-code}\ntm_shape(mpsz_pop2020) +\n  tm_fill(\"DEPENDENCY\",\n          n = 5,\n          style = \"fisher\") + \n  tm_borders(alpha = 0.5)\n```\n\n::: {.cell-output-display}\n![](Hands_on_Ex01_files/figure-html/unnamed-chunk-51-1.png){width=672}\n:::\n:::\n\n\nUsing jenks classification method:\n\n\n::: {.cell}\n\n```{.r .cell-code}\ntm_shape(mpsz_pop2020) +\n  tm_fill(\"DEPENDENCY\",\n          n = 5,\n          style = \"jenks\") + \n  tm_borders(alpha = 0.5)\n```\n\n::: {.cell-output-display}\n![](Hands_on_Ex01_files/figure-html/unnamed-chunk-52-1.png){width=672}\n:::\n:::\n\n\nUsing jenks classification method with 6 classes:\n\n\n::: {.cell}\n\n```{.r .cell-code}\ntm_shape(mpsz_pop2020) +\n  tm_fill(\"DEPENDENCY\",\n          n = 6,\n          style = \"jenks\") + \n  tm_borders(alpha = 0.5)\n```\n\n::: {.cell-output-display}\n![](Hands_on_Ex01_files/figure-html/unnamed-chunk-53-1.png){width=672}\n:::\n:::\n\n\nUsing jenks classification method with 10 classes:\n\n\n::: {.cell}\n\n```{.r .cell-code}\ntm_shape(mpsz_pop2020) +\n  tm_fill(\"DEPENDENCY\",\n          n = 10,\n          style = \"jenks\") + \n  tm_borders(alpha = 0.5)\n```\n\n::: {.cell-output-display}\n![](Hands_on_Ex01_files/figure-html/unnamed-chunk-54-1.png){width=672}\n:::\n:::\n\n\nUsing jenks classification method with 20 classes:\n\n\n::: {.cell}\n\n```{.r .cell-code}\ntm_shape(mpsz_pop2020) +\n  tm_fill(\"DEPENDENCY\",\n          n = 20,\n          style = \"jenks\") + \n  tm_borders(alpha = 0.5)\n```\n\n::: {.cell-output-display}\n![](Hands_on_Ex01_files/figure-html/unnamed-chunk-55-1.png){width=672}\n:::\n:::\n\n\nUsing different number of classes narrows the range of each bin and more subtle changes in colours between bins.\n\n#### 3.2.3.2. Plotting Choropleth Maps with Custom Breaks\n\nThe category breaks for built-in methods are calculated in the background. The default can be overriden by setting the breakpoints explicitly using `breaks` in `tm_fill()`. As the breaks include the minimum and maximum values, **n+1** elements must be defined in `breaks` in increasing order.\n\nUsing the code below, we can examine the descriptive statistics of the variable before deciding on the break points:\n\n\n::: {.cell}\n\n```{.r .cell-code}\nsummary(mpsz_pop2020$DEPENDENCY)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n   Min. 1st Qu.  Median    Mean 3rd Qu.    Max.    NA's \n 0.1111  0.7147  0.7866  0.8585  0.8763 19.0000      92 \n```\n:::\n:::\n\n\nUsing the results, we will set the break points at 0.60, 0.70, 0.80, and 0.90. The minimum and maximum is set at 0 and 1.00 respectively.\n\n\n::: {.cell}\n\n```{.r .cell-code}\ntm_shape(mpsz_pop2020) +\n  tm_fill(\"DEPENDENCY\",\n          breaks = c(0, 0.60, 0.70, 0.80, 0.90, 1.00)) +\n  tm_borders(alpha = 0.5)\n```\n\n::: {.cell-output-display}\n![](Hands_on_Ex01_files/figure-html/unnamed-chunk-57-1.png){width=672}\n:::\n:::\n\n\n### 3.2.4. Customising Colour Scheme using RColorBrewer Palettes\n\n`tmap` supports colour ramps defined by the user or by a set of pre-defined colour ramps from the `RColorBrewer` package.\n\nThe preferred colour to be used on the choropleth map can be defined using the `palette` argument in `tm_fill()`:\n\n\n::: {.cell}\n\n```{.r .cell-code}\ntm_shape(mpsz_pop2020) +\n  tm_fill(\"DEPENDENCY\",\n          n = 6,\n          style = \"quantile\",\n          palette = \"Blues\") +\n  tm_borders(alpha = 0.5)\n```\n\n::: {.cell-output-display}\n![](Hands_on_Ex01_files/figure-html/unnamed-chunk-58-1.png){width=672}\n:::\n:::\n\n\nBy default, the colours are used from light to dark in ascending order of the values associated with it. The shades of the colours used can be reversed by adding a \"-\" prefix:\n\n\n::: {.cell}\n\n```{.r .cell-code}\ntm_shape(mpsz_pop2020) +\n  tm_fill(\"DEPENDENCY\",\n          n = 6,\n          style = \"quantile\",\n          palette = \"-Greens\") +\n  tm_borders(alpha = 0.5)\n```\n\n::: {.cell-output-display}\n![](Hands_on_Ex01_files/figure-html/unnamed-chunk-59-1.png){width=672}\n:::\n:::\n\n\n### 3.2.5. Customising Map Layouts\n\nMap layout refers to the different elements in a map such as the objects to be mapped, title, scale bar, compass, margins and aspect ratios.\n\n#### 3.2.5.1. Map Legend\n\nDifferent legend options are available in `tmap` to customise the placement, format, and appearance of the legend:\n\n\n::: {.cell}\n\n```{.r .cell-code}\ntm_shape(mpsz_pop2020) +\n  tm_fill(\"DEPENDENCY\",\n          style = \"jenks\",\n          palette = 'Blues',\n          legend.hist = TRUE,\n          legend.is.portrait = TRUE,\n          legend.hist.z = 0.1) +\n  tm_layout(main.title = \"Distribution of Dependency Ratio by Planning Subzone\\n(Jenks Classification)\",\n            main.title.position = \"center\",\n            main.title.size = 1,\n            legend.height = 0.45,\n            legend.width = 0.35,\n            legend.outside = FALSE,\n            legend.position = c(\"right\",\"bottom\"),\n            frame = FALSE) +\n  tm_borders(alpha = 0.5)\n```\n\n::: {.cell-output-display}\n![](Hands_on_Ex01_files/figure-html/unnamed-chunk-60-1.png){width=672}\n:::\n:::\n\n\n#### 3.2.5.2. Map Style\n\nDifferent layout settings can be changed using `tmap_style()`. Available styles are `\"classic\"`, `\"white\"` (default), `\"gray\"`, `\"natural\"`, `\"cobalt\"`, `\"col_blind\"`, `\"albatross\"`, `\"beaver\"`, `\"bw\"`, `\"watercolor\"`, etc.\n\nUsing `\"classic\"` style:\n\n\n::: {.cell}\n\n```{.r .cell-code}\ntm_shape(mpsz_pop2020) +\n  tm_fill(\"DEPENDENCY\",\n          style = \"quantile\",\n          palette = \"-Greens\") + \n  tm_borders(alpha = 0.5) +\n  tmap_style(\"classic\")\n```\n\n::: {.cell-output-display}\n![](Hands_on_Ex01_files/figure-html/unnamed-chunk-61-1.png){width=672}\n:::\n:::\n\n\n#### 3.2.5.3. Cartographic Furniture\n\nAdditional map furniture such as compass, scale bar, and grid lines may be added to the map using `tm_compass()`, `tm_scale_bar()`, and `tm_grid()` respectively:\n\n\n::: {.cell}\n\n```{.r .cell-code}\ntm_shape(mpsz_pop2020) +\n  tm_fill(\"DEPENDENCY\",\n          style = \"quantile\",\n          palette = \"Blues\",\n          title = \"No. of Persons\") + \n  tm_layout(main.title = \"Distribution of Dependency Ratio \\nby Planning Subzone\",\n            main.title.position = \"center\",\n            main.title.size = 1.2,\n            legend.height = 0.45,\n            legend.width = 0.35,\n            frame = TRUE) +\n  tm_borders(alpha = 0.5) +\n  tm_compass(type = \"8star\", size = 2) +\n  tm_scale_bar(width = 0.15) +\n  tm_grid(lwd = 0.1, alpha = 0.2) +\n  tm_credits(\"Source: Planning Subzone Boundary from URA\\n\n             Population data from DOS\")\n```\n\n::: {.cell-output-display}\n![](Hands_on_Ex01_files/figure-html/unnamed-chunk-62-1.png){width=672}\n:::\n:::\n\n\nThe map style follows the last change. We can use the following code to reset the map style to default:\n\n\n::: {.cell}\n\n```{.r .cell-code}\ntmap_style(\"white\")\n```\n:::\n\n\n### 3.2.6. Drawing Small Multiple Choropleth Maps\n\nFacet maps are composed of multiple maps arranged in a grid (adjacent or stacked). This allows for the visualisation of changes in spatial relationships in response to another variable such as time.\n\nSmall multiples, or facet maps, can be plotted in three ways:\n\n1.  By assigning multiple values to as least one aesthetic arguments\n\n2.  By defining a group-by variable in `tm_facets()`\n\n3.  By creating multiple standalone maps with `tmap_arrange()`\n\n#### 3.2.6.1. Assigning Multiple Values to One Aesthetic Argument\n\nSmall multiple maps can be created by defining `ncols` in `tm_fill()`:\n\n\n::: {.cell}\n\n```{.r .cell-code}\ntm_shape(mpsz_pop2020) +\n  tm_fill(c(\"YOUNG\", 'AGED'),\n          style = 'equal',\n          palette = 'Blues') +\n  tm_layout(legend.position = c('right','bottom')) +\n  tm_borders(alpha = 0.5)\n```\n\n::: {.cell-output-display}\n![](Hands_on_Ex01_files/figure-html/unnamed-chunk-64-1.png){width=672}\n:::\n:::\n\n\nSmall multiple maps can also be created by assigning multiple values to at least one of the aesthetic arguments:\n\n\n::: {.cell}\n\n```{.r .cell-code}\ntm_shape(mpsz_pop2020) +\n  tm_fill(c(\"DEPENDENCY\", 'AGED'),\n          style = c('equal','quantile'),\n          palette = list('Blues', 'Greens')) +\n  tm_layout(legend.position = c('right','bottom')) +\n  tm_borders(alpha = 0.5)\n```\n\n::: {.cell-output-display}\n![](Hands_on_Ex01_files/figure-html/unnamed-chunk-65-1.png){width=672}\n:::\n:::\n\n\n#### 3.2.6.2. Defining Group-by Variable in `tm_facets()`\n\nSmall multiple choropleth maps can be created using `tm_facets()`:\n\n\n::: {.cell}\n\n```{.r .cell-code}\ntm_shape(mpsz_pop2020) +\n  tm_fill(\"DEPENDENCY\",\n          style = 'quantile',\n          palette = 'Blues',\n          thres.poly = 0) +\n  tm_facets(by = 'REGION_N',\n            free.coords = TRUE,\n            drop.shapes = TRUE) +\n  tm_layout(legend.show = FALSE,\n            title.position = c(\"center\", \"center\"),\n            title.size = 20)+\n  tm_borders(alpha = 0.5)\n```\n\n::: {.cell-output-display}\n![](Hands_on_Ex01_files/figure-html/unnamed-chunk-66-1.png){width=672}\n:::\n:::\n\n\n#### 3.2.6.2. Creating Multiple Standalone Maps with `tmap_arrange()`\n\nSmall multiple choropleth maps can be created using `tm_arrange()`:\n\n\n::: {.cell}\n\n```{.r .cell-code}\nyoungmap <- tm_shape(mpsz_pop2020) +\n  tm_polygons(\"YOUNG\",\n              style = \"quantile\",\n              palette = \"Blues\")\n\nagedmap <- tm_shape(mpsz_pop2020) +\n  tm_polygons(\"AGED\",\n              style = 'quantile',\n              palette = \"Blues\")\n\ntmap_arrange(youngmap, agedmap, asp = 1, ncol = 2)\n```\n\n::: {.cell-output-display}\n![](Hands_on_Ex01_files/figure-html/unnamed-chunk-67-1.png){width=672}\n:::\n:::\n\n\n### 3.2.7. Using Selection Criterion to Map Spatial Object\n\nThe selection function can be used to map spatial objects that meet a specified criterion.\n\n\n::: {.cell}\n\n```{.r .cell-code}\ntm_shape(mpsz_pop2020[mpsz_pop2020$REGION_N == 'CENTRAL REGION',]) +\n  tm_fill(\"DEPENDENCY\",\n          style = \"quantile\",\n          palette = \"Blues\",\n          legend.hist = TRUE,\n          legend.is.portrait = TRUE,\n          legend.hist.z = 0.1) +\n  tm_layout(legend.outside = TRUE,\n            legend.height = 0.45,\n            legend.width = 5.0,\n            legend.position = c(\"right\",\"bottom\"),\n            frame = FALSE) +\n  tm_borders(alpha = 0.5)\n```\n\n::: {.cell-output-display}\n![](Hands_on_Ex01_files/figure-html/unnamed-chunk-68-1.png){width=672}\n:::\n:::\n",
    "supporting": [
      "Hands_on_Ex01_files"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}