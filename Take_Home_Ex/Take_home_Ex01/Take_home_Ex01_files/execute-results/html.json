{
  "hash": "db9be70fd6cce807a5511c48daf53698",
  "result": {
    "markdown": "---\ntitle: \"Take-home Exercise 1\"\ndate: \"21 November 2023\"\ndate-modified: \"last-modified\"\nformat: html\nexecute: \n  echo: true # all code chunks will appear\n  eval: true # all code chunks will run live\n  warning: false # do not display warning message\neditor: visual\n---\n\n\n# 1. Overview\n\nIn this take-home exercise, we will examine the spatial and spatio-temporal mobility patterns of public bus passengers in Singapore. Exploratory Spatial Data Analysis (ESDA) will be used to visualise and analyse bus ridership data by origin in October 2023. Next, Local Indicators of Spatial Association analysis will be conducted to uncover spatial and spatio-temporal mobility patterns of bus passengers in Singapore.\n\n# 2. The Data\n\nWe will use the following data sets for this exercise:\n\n| S/N | Name of Data Set                                 | File type | Source                                                                            | Extracted to (file directory) |\n|------------|-------------|------------|-------------------------|------------|\n| 1   | Master Plan 2019 Subzone Boundary (Web)          | SHP       | [data.gov.sg](https://data.gov.sg/)                                               | /data/geospatial              |\n| 2   | Bus Stop Location                                | SHP       | [LTA DataMall](https://www.mytransport.sg/content/mytransport/home/dataMall.html) | /data/geospatial              |\n| 3   | Passenger Volume by Origin Destination Bus Stops | csv       | [LTA DataMall](https://www.mytransport.sg/content/mytransport/home/dataMall.html) | /data/aspatial                |\n\n## 2.1. Loading Relevant R Packages\n\nWe will first load the following packages into R using the following code:\n\n\n::: {.cell}\n\n```{.r .cell-code}\npacman::p_load(sf, tmap, sfdep, tidyverse, knitr)\n```\n:::\n\n\nThese packages will serve the following purpose:\n\n-   `sf`: geospatial data handling\n\n-   `tmap`: thematic mapping\n\n-   `sfdep`: to compute spatial weights and local spatial association statistics\n\n-   `tidyverse`: non-spatial data handling\n\n-   `knitr`: for creating html table\n\n## 2.2. Loading and Checking Data Sets\n\nThe first data set we will import is the *origin_destination_bus_202310* csv data. We will import it into R as `odbus` using `read_csv()` from the `readr` package:\n\n\n::: {.cell}\n\n```{.r .cell-code}\nodbus <- read_csv(\"data/aspatial/origin_destination_bus_202310.csv\")\nglimpse(odbus)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\nRows: 5,694,297\nColumns: 7\n$ YEAR_MONTH          <chr> \"2023-10\", \"2023-10\", \"2023-10\", \"2023-10\", \"2023-…\n$ DAY_TYPE            <chr> \"WEEKENDS/HOLIDAY\", \"WEEKDAY\", \"WEEKENDS/HOLIDAY\",…\n$ TIME_PER_HOUR       <dbl> 16, 16, 14, 14, 17, 17, 17, 7, 14, 14, 10, 20, 20,…\n$ PT_TYPE             <chr> \"BUS\", \"BUS\", \"BUS\", \"BUS\", \"BUS\", \"BUS\", \"BUS\", \"…\n$ ORIGIN_PT_CODE      <chr> \"04168\", \"04168\", \"80119\", \"80119\", \"44069\", \"2028…\n$ DESTINATION_PT_CODE <chr> \"10051\", \"10051\", \"90079\", \"90079\", \"17229\", \"2014…\n$ TOTAL_TRIPS         <dbl> 3, 5, 3, 5, 4, 1, 24, 2, 1, 7, 3, 2, 5, 1, 1, 1, 1…\n```\n:::\n:::\n\n\n> Note: use **`read_csv()`** from the `readr` package, which is part of the core `tidyverse`, instead of `read.csv()` from the R base package. `read_csv()` is typically faster, produces tibble tables and are more reproducible[^1].\n\n[^1]: https://r4ds.had.co.nz/data-import.html (Section 11.2.1)\n\nIt is observed that `ORIGIN_PT_CODE` and `DESTINATION_PT_CODE` are both recognised as integers. Since these are bus stop identifiers, they should be converted to factor type using the following code:\n\n\n::: {.cell}\n\n```{.r .cell-code}\nodbus$ORIGIN_PT_CODE <-\n  as.factor(odbus$ORIGIN_PT_CODE) \n\nodbus$DESTINATION_PT_CODE <-\n  as.factor(odbus$DESTINATION_PT_CODE)\n\nglimpse(odbus)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\nRows: 5,694,297\nColumns: 7\n$ YEAR_MONTH          <chr> \"2023-10\", \"2023-10\", \"2023-10\", \"2023-10\", \"2023-…\n$ DAY_TYPE            <chr> \"WEEKENDS/HOLIDAY\", \"WEEKDAY\", \"WEEKENDS/HOLIDAY\",…\n$ TIME_PER_HOUR       <dbl> 16, 16, 14, 14, 17, 17, 17, 7, 14, 14, 10, 20, 20,…\n$ PT_TYPE             <chr> \"BUS\", \"BUS\", \"BUS\", \"BUS\", \"BUS\", \"BUS\", \"BUS\", \"…\n$ ORIGIN_PT_CODE      <fct> 04168, 04168, 80119, 80119, 44069, 20281, 20281, 1…\n$ DESTINATION_PT_CODE <fct> 10051, 10051, 90079, 90079, 17229, 20141, 20141, 1…\n$ TOTAL_TRIPS         <dbl> 3, 5, 3, 5, 4, 1, 24, 2, 1, 7, 3, 2, 5, 1, 1, 1, 1…\n```\n:::\n:::\n\n\nThe second dataset we will import is the *BusStop* SHP file. This file will be imported into R as `busstop` using the `st_read()` function from the `sf` package:\n\n\n::: {.cell}\n\n```{.r .cell-code}\nbusstop <- st_read(dsn=\"data/geospatial\",\n                   layer = \"BusStop\") %>%\n  st_transform(crs = 3414)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\nReading layer `BusStop' from data source \n  `C:\\Users\\noel1\\Documents\\School\\02. Special Sem 1\\ISSS624 Geospatial Analysis\\noelnomel\\ISSS624\\Take_home_Ex\\Take_home_Ex01\\data\\geospatial' \n  using driver `ESRI Shapefile'\nSimple feature collection with 5161 features and 3 fields\nGeometry type: POINT\nDimension:     XY\nBounding box:  xmin: 3970.122 ymin: 26482.1 xmax: 48284.56 ymax: 52983.82\nProjected CRS: SVY21\n```\n:::\n\n```{.r .cell-code}\nglimpse(busstop)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\nRows: 5,161\nColumns: 4\n$ BUS_STOP_N <chr> \"22069\", \"32071\", \"44331\", \"96081\", \"11561\", \"66191\", \"2338…\n$ BUS_ROOF_N <chr> \"B06\", \"B23\", \"B01\", \"B05\", \"B05\", \"B03\", \"B02A\", \"B02\", \"B…\n$ LOC_DESC   <chr> \"OPP CEVA LOGISTICS\", \"AFT TRACK 13\", \"BLK 239\", \"GRACE IND…\n$ geometry   <POINT [m]> POINT (13576.31 32883.65), POINT (13228.59 44206.38),…\n```\n:::\n:::\n\n\n> `st_transform` is used to project the coordinates of the simple feature onto the Singapore SVY21 coordinate system (EPSG:3414).\n\nLastly, we will import the *Master Plan 2019 Subzone Boundary* SHP file. This file will be imported into R as `mpsz2019` using the `st_read()` function from the `sf` package:\n\n\n::: {.cell}\n\n```{.r .cell-code}\nmpsz2019 <- st_read(dsn=\"data/geospatial\",\n                   layer = \"MPSZ-2019\") %>%\n  st_transform(crs=3414)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\nReading layer `MPSZ-2019' from data source \n  `C:\\Users\\noel1\\Documents\\School\\02. Special Sem 1\\ISSS624 Geospatial Analysis\\noelnomel\\ISSS624\\Take_home_Ex\\Take_home_Ex01\\data\\geospatial' \n  using driver `ESRI Shapefile'\nSimple feature collection with 332 features and 6 fields\nGeometry type: MULTIPOLYGON\nDimension:     XY\nBounding box:  xmin: 103.6057 ymin: 1.158699 xmax: 104.0885 ymax: 1.470775\nGeodetic CRS:  WGS 84\n```\n:::\n\n```{.r .cell-code}\nglimpse(mpsz2019)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\nRows: 332\nColumns: 7\n$ SUBZONE_N  <chr> \"MARINA EAST\", \"INSTITUTION HILL\", \"ROBERTSON QUAY\", \"JURON…\n$ SUBZONE_C  <chr> \"MESZ01\", \"RVSZ05\", \"SRSZ01\", \"WISZ01\", \"MUSZ02\", \"MPSZ05\",…\n$ PLN_AREA_N <chr> \"MARINA EAST\", \"RIVER VALLEY\", \"SINGAPORE RIVER\", \"WESTERN …\n$ PLN_AREA_C <chr> \"ME\", \"RV\", \"SR\", \"WI\", \"MU\", \"MP\", \"WI\", \"WI\", \"SI\", \"SI\",…\n$ REGION_N   <chr> \"CENTRAL REGION\", \"CENTRAL REGION\", \"CENTRAL REGION\", \"WEST…\n$ REGION_C   <chr> \"CR\", \"CR\", \"CR\", \"WR\", \"CR\", \"CR\", \"WR\", \"WR\", \"CR\", \"CR\",…\n$ geometry   <MULTIPOLYGON [m]> MULTIPOLYGON (((33222.98 29..., MULTIPOLYGON (…\n```\n:::\n:::\n\n\n## 2.3. Extracting Study Data\n\nIn this exercise, we will focus on the bus ridership by origin bus stop in the following peak travel periods:\n\n| Peak Period              | Bus Tap-on Time |\n|--------------------------|-----------------|\n| Weekday mornings         | 06:00 to 09:00  |\n| Weekday evenings         | 17:00 to 20:00  |\n| Weekend/holiday mornings | 11:00 to 14:00  |\n| Weekend/holiday evenings | 16:00 to 19:00  |\n\nWe will extract each peak period separately using the following codes:\n\nWeekday morning peak:\n\n\n::: {.cell}\n\n```{.r .cell-code}\nori_WD_AM <- odbus %>%\n  filter(DAY_TYPE == 'WEEKDAY') %>%\n  filter(TIME_PER_HOUR >= 6 &\n          TIME_PER_HOUR <= 9) %>%\n  group_by(ORIGIN_PT_CODE) %>%\n  summarise(TRIPS = sum(TOTAL_TRIPS))\n\nglimpse(ori_WD_AM)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\nRows: 5,029\nColumns: 2\n$ ORIGIN_PT_CODE <fct> 01012, 01013, 01019, 01029, 01039, 01059, 01109, 01112,…\n$ TRIPS          <dbl> 1770, 841, 1530, 2483, 2919, 1734, 200, 8593, 7749, 368…\n```\n:::\n\n```{.r .cell-code}\nwrite_rds(ori_WD_AM, \"data/rds/ori_WD_AM.rds\")\n```\n:::\n\n\nWeekday evening peak:\n\n\n::: {.cell}\n\n```{.r .cell-code}\nori_WD_PM <- odbus %>%\n  filter(DAY_TYPE == 'WEEKDAY') %>%\n  filter(TIME_PER_HOUR >= 17 &\n          TIME_PER_HOUR <= 20) %>%\n  group_by(ORIGIN_PT_CODE) %>%\n  summarise(TRIPS = sum(TOTAL_TRIPS))\n\nglimpse(ori_WD_PM)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\nRows: 5,039\nColumns: 2\n$ ORIGIN_PT_CODE <fct> 01012, 01013, 01019, 01029, 01039, 01059, 01109, 01112,…\n$ TRIPS          <dbl> 8000, 7038, 3398, 9089, 12095, 2212, 276, 43513, 25769,…\n```\n:::\n\n```{.r .cell-code}\nwrite_rds(ori_WD_PM, \"data/rds/ori_WD_PM.rds\")\n```\n:::\n\n\nWeekend/holiday morning peak:\n\n\n::: {.cell}\n\n```{.r .cell-code}\nori_WE_AM <- odbus %>%\n  filter(DAY_TYPE == 'WEEKENDS/HOLIDAY') %>%\n  filter(TIME_PER_HOUR >= 11 &\n          TIME_PER_HOUR <= 14) %>%\n  group_by(ORIGIN_PT_CODE) %>%\n  summarise(TRIPS = sum(TOTAL_TRIPS))\n\nglimpse(ori_WE_AM)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\nRows: 5,012\nColumns: 2\n$ ORIGIN_PT_CODE <fct> 01012, 01013, 01019, 01029, 01039, 01059, 01109, 01112,…\n$ TRIPS          <dbl> 2177, 1818, 1536, 3217, 5408, 1159, 116, 15354, 8805, 6…\n```\n:::\n\n```{.r .cell-code}\nwrite_rds(ori_WE_AM, \"data/rds/ori_WE_AM.rds\")\n```\n:::\n\n\nWeekend/holiday evening peak:\n\n\n::: {.cell}\n\n```{.r .cell-code}\nori_WE_PM <- odbus %>%\n  filter(DAY_TYPE == 'WEEKENDS/HOLIDAY') %>%\n  filter(TIME_PER_HOUR >= 16 &\n          TIME_PER_HOUR <= 19) %>%\n  group_by(ORIGIN_PT_CODE) %>%\n  summarise(TRIPS = sum(TOTAL_TRIPS))\n\nglimpse(ori_WE_PM)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\nRows: 4,992\nColumns: 2\n$ ORIGIN_PT_CODE <fct> 01012, 01013, 01019, 01029, 01039, 01059, 01109, 01112,…\n$ TRIPS          <dbl> 3061, 2770, 1685, 4063, 7263, 1118, 101, 21405, 11556, …\n```\n:::\n\n```{.r .cell-code}\nwrite_rds(ori_WE_PM, \"data/rds/ori_WE_PM.rds\")\n```\n:::\n\n\n# 3. Create Hexagon Layer of `mpsz2019`\n\nNext, we will create a hexagon tessellation layer using `mpsz2019`. A hexagon layer is created to replace the irregular planning subzone polygons to reduce sampling bias[^2].\n\n[^2]: https://desktop.arcgis.com/en/arcmap/latest/tools/spatial-statistics-toolbox/h-whyhexagons.htm\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# calculate cellsize using perpendicular distance from center to edge of 250m\n\n# update on 7 Dec 2023 after realising some calculation mistakes\n# cell size = 2 x edge length (since regular hexagons are made of equilateral triangles)\n# apothem = perpendicular distance from center to any edge\n# edge length = (2 x apothem) / sqrt(3) \n# cell size = (4 x apothem) / sqrt(3)\ncs <- (4 * 250) / sqrt(3)\n\n# make hexagonal tesellation and add grid ID\nmpsz2019_grid <- st_make_grid(mpsz2019, c(cs,cs), square = FALSE) %>%\n  st_sf() %>%\n  mutate(id = row_number())\n\nmpsz2019_grid$id <- as.factor(mpsz2019_grid$id)\n\n# determine centroid for each hexagon\ncent <- st_centroid(mpsz2019_grid)\n\n# determine the intersection of centroids with mpsz2019\nmpsz2019_map <- st_intersection(cent, mpsz2019)\n\ncent_no_geom <- st_drop_geometry(mpsz2019_map)\n\n# create hexagon layer, drop_na() to suppress cells outside the country\nhexagon <- left_join(mpsz2019_grid, cent_no_geom) %>%\n  drop_na()\n\nqtm(hexagon)\n```\n\n::: {.cell-output-display}\n![](Take_home_Ex01_files/figure-html/unnamed-chunk-10-1.png){width=672}\n:::\n:::\n\n\n# 4. Geospatial Visualisation of Passenger Trips by Origin\n\n## 4.1. Geospatial Data Wrangling\n\n### 4.1.1. Weekday AM Peak Hours (by Origin)\n\nFirstly, we perform a `left_join()` using `busstop` and `ori_WD_AM` to populate trips by origin bus stop to the full list of bus stops in Singapore. This generates NA values for bus stops where no origin trips were taken during weekday morning peak periods in October 2023. This retains the simple feature dataframe for the next step.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nbs_ori_WD_AM <- left_join(busstop, ori_WD_AM,\n                       by = c('BUS_STOP_N' = 'ORIGIN_PT_CODE'))\n\nhead(bs_ori_WD_AM)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\nSimple feature collection with 6 features and 4 fields\nGeometry type: POINT\nDimension:     XY\nBounding box:  xmin: 13228.59 ymin: 30391.85 xmax: 41603.76 ymax: 44206.38\nProjected CRS: SVY21 / Singapore TM\n  BUS_STOP_N BUS_ROOF_N             LOC_DESC TRIPS                  geometry\n1      22069        B06   OPP CEVA LOGISTICS    50 POINT (13576.31 32883.65)\n2      32071        B23         AFT TRACK 13    NA POINT (13228.59 44206.38)\n3      44331        B01              BLK 239  2075  POINT (21045.1 40242.08)\n4      96081        B05 GRACE INDEPENDENT CH   411 POINT (41603.76 35413.11)\n5      11561        B05              BLK 166   207 POINT (24568.74 30391.85)\n6      66191        B03         AFT CORFE PL   405 POINT (30951.58 38079.61)\n```\n:::\n:::\n\n\nNext, we use `st_join` from the `sf` package to perform a spatial left join between the `hexagon` layer and the `bs_ori_WD_AM` simple feature dataframe. Bus stop coordinates that intersect with each hexagon polygon will be assigned the corresponding grid `id`.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nWD_AM_map <- st_join(hexagon, bs_ori_WD_AM) %>%\n  select(id, BUS_STOP_N, TRIPS, geometry)\n\nglimpse(WD_AM_map)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\nRows: 6,620\nColumns: 4\n$ id         <fct> 78, 79, 113, 114, 115, 116, 117, 118, 148, 149, 150, 151, 1…\n$ BUS_STOP_N <chr> NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA,…\n$ TRIPS      <dbl> NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA,…\n$ geometry   <POLYGON [m]> POLYGON ((2956.213 22915.39..., POLYGON ((2956.213 …\n```\n:::\n:::\n\n\nNext, we check for duplicates in the resultant simple feature dataframe:\n\n\n::: {.cell}\n\n```{.r .cell-code}\nduplicates <- WD_AM_map %>%\n  group_by_all() %>%\n  filter(n() > 1) %>%\n  ungroup()\n\nhead(duplicates, 20)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\nSimple feature collection with 20 features and 3 fields\nGeometry type: POLYGON\nDimension:     XY\nBounding box:  xmin: 13348.52 ymin: 32415.39 xmax: 44525.43 ymax: 48082.05\nProjected CRS: SVY21 / Singapore TM\n# A tibble: 20 × 4\n   id    BUS_STOP_N TRIPS                                               geometry\n   <fct> <chr>      <dbl>                                          <POLYGON [m]>\n 1 1386  22501      11384 ((13637.19 35415.39, 13348.52 35582.05, 13348.52 3591…\n 2 1386  22501      11384 ((13637.19 35415.39, 13348.52 35582.05, 13348.52 3591…\n 3 2017  43709       1329 ((18833.35 36415.39, 18544.67 36582.05, 18544.67 3691…\n 4 2017  43709       1329 ((18833.35 36415.39, 18544.67 36582.05, 18544.67 3691…\n 5 2503  11009      17311 ((22874.8 32415.39, 22586.12 32582.05, 22586.12 32915…\n 6 2503  11009      17311 ((22874.8 32415.39, 22586.12 32582.05, 22586.12 32915…\n 7 2518  47201      25910 ((22874.8 47415.39, 22586.12 47582.05, 22586.12 47915…\n 8 2518  47201      25910 ((22874.8 47415.39, 22586.12 47582.05, 22586.12 47915…\n 9 3171  51071       6698 ((28359.62 35915.39, 28070.95 36082.05, 28070.95 3641…\n10 3171  51071       6698 ((28359.62 35915.39, 28070.95 36082.05, 28070.95 3641…\n11 3947  67421        258 ((34710.48 41915.39, 34421.8 42082.05, 34421.8 42415.…\n12 3947  67421        258 ((34710.48 41915.39, 34421.8 42082.05, 34421.8 42415.…\n13 4008  82221       3998 ((35287.83 32915.39, 34999.15 33082.05, 34999.15 3341…\n14 4008  82221       3998 ((35287.83 32915.39, 34999.15 33082.05, 34999.15 3341…\n15 4050  62251       8605 ((35576.5 39415.39, 35287.83 39582.05, 35287.83 39915…\n16 4050  62251       8605 ((35576.5 39415.39, 35287.83 39582.05, 35287.83 39915…\n17 4850  96319        675 ((42216.03 34915.39, 41927.36 35082.05, 41927.36 3541…\n18 4850  96319        675 ((42216.03 34915.39, 41927.36 35082.05, 41927.36 3541…\n19 5099  97079       3822 ((44236.76 38415.39, 43948.08 38582.05, 43948.08 3891…\n20 5099  97079       3822 ((44236.76 38415.39, 43948.08 38582.05, 43948.08 3891…\n```\n:::\n:::\n\n\nFirst, using `glimpse()` we know that there are 20 duplicate records. We will use `head()` to display all 20 records to conduct a visual check.\n\nNext, we will remove the duplicate values:\n\n\n::: {.cell}\n\n```{.r .cell-code}\nWD_AM_map <- unique(WD_AM_map)\n  \nglimpse(WD_AM_map)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\nRows: 6,610\nColumns: 4\n$ id         <fct> 78, 79, 113, 114, 115, 116, 117, 118, 148, 149, 150, 151, 1…\n$ BUS_STOP_N <chr> NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA,…\n$ TRIPS      <dbl> NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA,…\n$ geometry   <POLYGON [m]> POLYGON ((2956.213 22915.39..., POLYGON ((2956.213 …\n```\n:::\n:::\n\n\nWe will now check for the occurrence of multiple bus stops with the same hexagon grid:\n\n\n::: {.cell}\n\n```{.r .cell-code}\nby_id <- WD_AM_map %>%\n  group_by(id) %>%\n  filter(n() > 1) %>%\n  ungroup()\n\nglimpse(by_id)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\nRows: 5,015\nColumns: 4\n$ id         <fct> 295, 295, 295, 331, 331, 365, 365, 365, 366, 366, 367, 367,…\n$ BUS_STOP_N <chr> \"25719\", \"25711\", \"26389\", \"25701\", \"25709\", \"26409\", \"2639…\n$ TRIPS      <dbl> 815, 251, 301, 274, 760, 32, 257, 2, 71, 1819, 9, 26, 152, …\n$ geometry   <POLYGON [m]> POLYGON ((4688.264 29915.39..., POLYGON ((4688.264 …\n```\n:::\n:::\n\n\nIt is observed that there are 4,931 records of such occurrences. We will sum all origin trips by each hexagon grid using the following code:\n\n\n::: {.cell}\n\n```{.r .cell-code}\nWD_AM_map <- WD_AM_map %>%\n  group_by(id) %>%\n  summarise(TRIPS = sum(TRIPS))\n\nglimpse(WD_AM_map)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\nRows: 2,711\nColumns: 3\n$ id       <fct> 78, 79, 113, 114, 115, 116, 117, 118, 148, 149, 150, 151, 152…\n$ TRIPS    <dbl> NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, N…\n$ geometry <POLYGON [m]> POLYGON ((2956.213 22915.39..., POLYGON ((2956.213 23…\n```\n:::\n:::\n\n\nWe repeat the above data wrangling steps for the remaining three study datasets:\n\n### 4.1.2. Weekday PM Peak Hours (by Origin)\n\n\n::: {.cell}\n\n```{.r .cell-code}\nbs_ori_WD_PM <- left_join(busstop, ori_WD_PM,\n                       by = c('BUS_STOP_N' = 'ORIGIN_PT_CODE'))\n\nglimpse(bs_ori_WD_PM)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\nRows: 5,161\nColumns: 5\n$ BUS_STOP_N <chr> \"22069\", \"32071\", \"44331\", \"96081\", \"11561\", \"66191\", \"2338…\n$ BUS_ROOF_N <chr> \"B06\", \"B23\", \"B01\", \"B05\", \"B05\", \"B03\", \"B02A\", \"B02\", \"B…\n$ LOC_DESC   <chr> \"OPP CEVA LOGISTICS\", \"AFT TRACK 13\", \"BLK 239\", \"GRACE IND…\n$ TRIPS      <dbl> 67, 5, 1740, 445, 199, 349, 432, 1285, 3653, 1379, 181, 536…\n$ geometry   <POINT [m]> POINT (13576.31 32883.65), POINT (13228.59 44206.38),…\n```\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nWD_PM_map <- st_join(hexagon, bs_ori_WD_PM) %>%\n  select(id, BUS_STOP_N, TRIPS, geometry)\n\nglimpse(WD_PM_map)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\nRows: 6,620\nColumns: 4\n$ id         <fct> 78, 79, 113, 114, 115, 116, 117, 118, 148, 149, 150, 151, 1…\n$ BUS_STOP_N <chr> NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA,…\n$ TRIPS      <dbl> NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA,…\n$ geometry   <POLYGON [m]> POLYGON ((2956.213 22915.39..., POLYGON ((2956.213 …\n```\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nduplicates <- WD_PM_map %>%\n  group_by_all() %>%\n  filter(n() > 1) %>%\n  ungroup()\n\nhead(duplicates, 20)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\nSimple feature collection with 20 features and 3 fields\nGeometry type: POLYGON\nDimension:     XY\nBounding box:  xmin: 13348.52 ymin: 32415.39 xmax: 44525.43 ymax: 48082.05\nProjected CRS: SVY21 / Singapore TM\n# A tibble: 20 × 4\n   id    BUS_STOP_N TRIPS                                               geometry\n   <fct> <chr>      <dbl>                                          <POLYGON [m]>\n 1 1386  22501       2533 ((13637.19 35415.39, 13348.52 35582.05, 13348.52 3591…\n 2 1386  22501       2533 ((13637.19 35415.39, 13348.52 35582.05, 13348.52 3591…\n 3 2017  43709       1608 ((18833.35 36415.39, 18544.67 36582.05, 18544.67 3691…\n 4 2017  43709       1608 ((18833.35 36415.39, 18544.67 36582.05, 18544.67 3691…\n 5 2503  11009       6229 ((22874.8 32415.39, 22586.12 32582.05, 22586.12 32915…\n 6 2503  11009       6229 ((22874.8 32415.39, 22586.12 32582.05, 22586.12 32915…\n 7 2518  47201      15689 ((22874.8 47415.39, 22586.12 47582.05, 22586.12 47915…\n 8 2518  47201      15689 ((22874.8 47415.39, 22586.12 47582.05, 22586.12 47915…\n 9 3171  51071      14145 ((28359.62 35915.39, 28070.95 36082.05, 28070.95 3641…\n10 3171  51071      14145 ((28359.62 35915.39, 28070.95 36082.05, 28070.95 3641…\n11 3947  67421        297 ((34710.48 41915.39, 34421.8 42082.05, 34421.8 42415.…\n12 3947  67421        297 ((34710.48 41915.39, 34421.8 42082.05, 34421.8 42415.…\n13 4008  82221       2871 ((35287.83 32915.39, 34999.15 33082.05, 34999.15 3341…\n14 4008  82221       2871 ((35287.83 32915.39, 34999.15 33082.05, 34999.15 3341…\n15 4050  62251       1874 ((35576.5 39415.39, 35287.83 39582.05, 35287.83 39915…\n16 4050  62251       1874 ((35576.5 39415.39, 35287.83 39582.05, 35287.83 39915…\n17 4850  96319       2996 ((42216.03 34915.39, 41927.36 35082.05, 41927.36 3541…\n18 4850  96319       2996 ((42216.03 34915.39, 41927.36 35082.05, 41927.36 3541…\n19 5099  97079       1980 ((44236.76 38415.39, 43948.08 38582.05, 43948.08 3891…\n20 5099  97079       1980 ((44236.76 38415.39, 43948.08 38582.05, 43948.08 3891…\n```\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nWD_PM_map <- unique(WD_PM_map)\n  \nglimpse(WD_PM_map)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\nRows: 6,610\nColumns: 4\n$ id         <fct> 78, 79, 113, 114, 115, 116, 117, 118, 148, 149, 150, 151, 1…\n$ BUS_STOP_N <chr> NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA,…\n$ TRIPS      <dbl> NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA,…\n$ geometry   <POLYGON [m]> POLYGON ((2956.213 22915.39..., POLYGON ((2956.213 …\n```\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nby_id <- WD_PM_map %>%\n  group_by(id) %>%\n  filter(n() > 1) %>%\n  ungroup()\n\nglimpse(by_id)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\nRows: 5,015\nColumns: 4\n$ id         <fct> 295, 295, 295, 331, 331, 365, 365, 365, 366, 366, 367, 367,…\n$ BUS_STOP_N <chr> \"25719\", \"25711\", \"26389\", \"25701\", \"25709\", \"26409\", \"2639…\n$ TRIPS      <dbl> 2600, 297, 299, 335, 2137, 156, 560, 84, 1258, 1588, 39, 14…\n$ geometry   <POLYGON [m]> POLYGON ((4688.264 29915.39..., POLYGON ((4688.264 …\n```\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nWD_PM_map <- WD_PM_map %>%\n  group_by(id) %>%\n  summarise(TRIPS = sum(TRIPS))\n\nglimpse(WD_PM_map)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\nRows: 2,711\nColumns: 3\n$ id       <fct> 78, 79, 113, 114, 115, 116, 117, 118, 148, 149, 150, 151, 152…\n$ TRIPS    <dbl> NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, N…\n$ geometry <POLYGON [m]> POLYGON ((2956.213 22915.39..., POLYGON ((2956.213 23…\n```\n:::\n:::\n\n\n### 4.1.3. Weekend/Holiday AM Peak Hours (by Origin)\n\n\n::: {.cell}\n\n```{.r .cell-code}\nbs_ori_WE_AM <- left_join(busstop, ori_WE_AM,\n                       by = c('BUS_STOP_N' = 'ORIGIN_PT_CODE'))\n\nglimpse(bs_ori_WE_AM)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\nRows: 5,161\nColumns: 5\n$ BUS_STOP_N <chr> \"22069\", \"32071\", \"44331\", \"96081\", \"11561\", \"66191\", \"2338…\n$ BUS_ROOF_N <chr> \"B06\", \"B23\", \"B01\", \"B05\", \"B05\", \"B03\", \"B02A\", \"B02\", \"B…\n$ LOC_DESC   <chr> \"OPP CEVA LOGISTICS\", \"AFT TRACK 13\", \"BLK 239\", \"GRACE IND…\n$ TRIPS      <dbl> 8, NA, 682, 110, 70, 177, 16, 1442, 2042, 920, 7, 2375, 56,…\n$ geometry   <POINT [m]> POINT (13576.31 32883.65), POINT (13228.59 44206.38),…\n```\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nWE_AM_map <- st_join(hexagon, bs_ori_WE_AM) %>%\n  select(id, BUS_STOP_N, TRIPS, geometry)\n\nglimpse(WE_AM_map)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\nRows: 6,620\nColumns: 4\n$ id         <fct> 78, 79, 113, 114, 115, 116, 117, 118, 148, 149, 150, 151, 1…\n$ BUS_STOP_N <chr> NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA,…\n$ TRIPS      <dbl> NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA,…\n$ geometry   <POLYGON [m]> POLYGON ((2956.213 22915.39..., POLYGON ((2956.213 …\n```\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nduplicates <- WE_AM_map %>%\n  group_by_all() %>%\n  filter(n() > 1) %>%\n  ungroup()\n\nhead(duplicates, 20)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\nSimple feature collection with 20 features and 3 fields\nGeometry type: POLYGON\nDimension:     XY\nBounding box:  xmin: 13348.52 ymin: 32415.39 xmax: 44525.43 ymax: 48082.05\nProjected CRS: SVY21 / Singapore TM\n# A tibble: 20 × 4\n   id    BUS_STOP_N TRIPS                                               geometry\n   <fct> <chr>      <dbl>                                          <POLYGON [m]>\n 1 1386  22501       1539 ((13637.19 35415.39, 13348.52 35582.05, 13348.52 3591…\n 2 1386  22501       1539 ((13637.19 35415.39, 13348.52 35582.05, 13348.52 3591…\n 3 2017  43709        415 ((18833.35 36415.39, 18544.67 36582.05, 18544.67 3691…\n 4 2017  43709        415 ((18833.35 36415.39, 18544.67 36582.05, 18544.67 3691…\n 5 2503  11009       4698 ((22874.8 32415.39, 22586.12 32582.05, 22586.12 32915…\n 6 2503  11009       4698 ((22874.8 32415.39, 22586.12 32582.05, 22586.12 32915…\n 7 2518  47201       2204 ((22874.8 47415.39, 22586.12 47582.05, 22586.12 47915…\n 8 2518  47201       2204 ((22874.8 47415.39, 22586.12 47582.05, 22586.12 47915…\n 9 3171  51071       5163 ((28359.62 35915.39, 28070.95 36082.05, 28070.95 3641…\n10 3171  51071       5163 ((28359.62 35915.39, 28070.95 36082.05, 28070.95 3641…\n11 3947  67421         91 ((34710.48 41915.39, 34421.8 42082.05, 34421.8 42415.…\n12 3947  67421         91 ((34710.48 41915.39, 34421.8 42082.05, 34421.8 42415.…\n13 4008  82221       2249 ((35287.83 32915.39, 34999.15 33082.05, 34999.15 3341…\n14 4008  82221       2249 ((35287.83 32915.39, 34999.15 33082.05, 34999.15 3341…\n15 4050  62251       1431 ((35576.5 39415.39, 35287.83 39582.05, 35287.83 39915…\n16 4050  62251       1431 ((35576.5 39415.39, 35287.83 39582.05, 35287.83 39915…\n17 4850  96319        164 ((42216.03 34915.39, 41927.36 35082.05, 41927.36 3541…\n18 4850  96319        164 ((42216.03 34915.39, 41927.36 35082.05, 41927.36 3541…\n19 5099  97079        290 ((44236.76 38415.39, 43948.08 38582.05, 43948.08 3891…\n20 5099  97079        290 ((44236.76 38415.39, 43948.08 38582.05, 43948.08 3891…\n```\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nWE_AM_map <- unique(WE_AM_map)\n  \nglimpse(WE_AM_map)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\nRows: 6,610\nColumns: 4\n$ id         <fct> 78, 79, 113, 114, 115, 116, 117, 118, 148, 149, 150, 151, 1…\n$ BUS_STOP_N <chr> NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA,…\n$ TRIPS      <dbl> NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA,…\n$ geometry   <POLYGON [m]> POLYGON ((2956.213 22915.39..., POLYGON ((2956.213 …\n```\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nby_id <- WE_AM_map %>%\n  group_by(id) %>%\n  filter(n() > 1) %>%\n  ungroup()\n\nglimpse(by_id)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\nRows: 5,015\nColumns: 4\n$ id         <fct> 295, 295, 295, 331, 331, 365, 365, 365, 366, 366, 367, 367,…\n$ BUS_STOP_N <chr> \"25719\", \"25711\", \"26389\", \"25701\", \"25709\", \"26409\", \"2639…\n$ TRIPS      <dbl> 367, 39, 88, 103, 588, 12, 49, 7, 148, 1066, 5, 15, 181, 4,…\n$ geometry   <POLYGON [m]> POLYGON ((4688.264 29915.39..., POLYGON ((4688.264 …\n```\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nWE_AM_map <- WE_AM_map %>%\n  group_by(id) %>%\n  summarise(TRIPS = sum(TRIPS))\n\nglimpse(WE_AM_map)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\nRows: 2,711\nColumns: 3\n$ id       <fct> 78, 79, 113, 114, 115, 116, 117, 118, 148, 149, 150, 151, 152…\n$ TRIPS    <dbl> NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, N…\n$ geometry <POLYGON [m]> POLYGON ((2956.213 22915.39..., POLYGON ((2956.213 23…\n```\n:::\n:::\n\n\n### 4.1.4. Weekend/Holiday PM Peak Hours (by Origin)\n\n\n::: {.cell}\n\n```{.r .cell-code}\nbs_ori_WE_PM <- left_join(busstop, ori_WE_PM,\n                       by = c('BUS_STOP_N' = 'ORIGIN_PT_CODE'))\n\nglimpse(bs_ori_WE_PM)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\nRows: 5,161\nColumns: 5\n$ BUS_STOP_N <chr> \"22069\", \"32071\", \"44331\", \"96081\", \"11561\", \"66191\", \"2338…\n$ BUS_ROOF_N <chr> \"B06\", \"B23\", \"B01\", \"B05\", \"B05\", \"B03\", \"B02A\", \"B02\", \"B…\n$ LOC_DESC   <chr> \"OPP CEVA LOGISTICS\", \"AFT TRACK 13\", \"BLK 239\", \"GRACE IND…\n$ TRIPS      <dbl> 10, NA, 589, 47, 77, 169, 82, 492, 2016, 724, 25, 2137, 91,…\n$ geometry   <POINT [m]> POINT (13576.31 32883.65), POINT (13228.59 44206.38),…\n```\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nWE_PM_map <- st_join(hexagon, bs_ori_WE_PM) %>%\n  select(id, BUS_STOP_N, TRIPS, geometry)\n\nglimpse(WE_PM_map)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\nRows: 6,620\nColumns: 4\n$ id         <fct> 78, 79, 113, 114, 115, 116, 117, 118, 148, 149, 150, 151, 1…\n$ BUS_STOP_N <chr> NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA,…\n$ TRIPS      <dbl> NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA,…\n$ geometry   <POLYGON [m]> POLYGON ((2956.213 22915.39..., POLYGON ((2956.213 …\n```\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nduplicates <- WE_PM_map %>%\n  group_by_all() %>%\n  filter(n() > 1) %>%\n  ungroup()\n\nglimpse(duplicates)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\nRows: 20\nColumns: 4\n$ id         <fct> 1386, 1386, 2017, 2017, 2503, 2503, 2518, 2518, 3171, 3171,…\n$ BUS_STOP_N <chr> \"22501\", \"22501\", \"43709\", \"43709\", \"11009\", \"11009\", \"4720…\n$ TRIPS      <dbl> 1315, 1315, 452, 452, 2451, 2451, 6331, 6331, 4450, 4450, 6…\n$ geometry   <POLYGON [m]> POLYGON ((13637.19 35415.39..., POLYGON ((13637.19 …\n```\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nWE_PM_map <- unique(WE_PM_map)\n  \nglimpse(WE_PM_map)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\nRows: 6,610\nColumns: 4\n$ id         <fct> 78, 79, 113, 114, 115, 116, 117, 118, 148, 149, 150, 151, 1…\n$ BUS_STOP_N <chr> NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA,…\n$ TRIPS      <dbl> NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA,…\n$ geometry   <POLYGON [m]> POLYGON ((2956.213 22915.39..., POLYGON ((2956.213 …\n```\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nby_id <- WE_PM_map %>%\n  group_by(id) %>%\n  filter(n() > 1) %>%\n  ungroup()\n\nglimpse(by_id)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\nRows: 5,015\nColumns: 4\n$ id         <fct> 295, 295, 295, 331, 331, 365, 365, 365, 366, 366, 367, 367,…\n$ BUS_STOP_N <chr> \"25719\", \"25711\", \"26389\", \"25701\", \"25709\", \"26409\", \"2639…\n$ TRIPS      <dbl> 533, 132, 101, 297, 733, 34, 111, 19, 168, 1256, 10, 34, 34…\n$ geometry   <POLYGON [m]> POLYGON ((4688.264 29915.39..., POLYGON ((4688.264 …\n```\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nWE_PM_map <- WE_PM_map %>%\n  group_by(id) %>%\n  summarise(TRIPS = sum(TRIPS))\n\nglimpse(WE_PM_map)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\nRows: 2,711\nColumns: 3\n$ id       <fct> 78, 79, 113, 114, 115, 116, 117, 118, 148, 149, 150, 151, 152…\n$ TRIPS    <dbl> NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, N…\n$ geometry <POLYGON [m]> POLYGON ((2956.213 22915.39..., POLYGON ((2956.213 23…\n```\n:::\n:::\n\n\n## 4.2. Visualising Geographical Distribution of Passenger Trips\n\n### 4.2.1. Weekday AM Peak Hours (by Origin)\n\n\n::: {.cell}\n\n```{.r .cell-code}\ntmap_mode(\"plot\")\ntm_shape(WD_AM_map) +\n  tm_fill(\"TRIPS\",\n          style = \"quantile\",\n          palette = \"Blues\",\n          id = \"TRIPS\") +\n  tm_layout(main.title = \"Trips by Origin on Weekday AM Peak Hours\",\n            main.title.position = \"center\",\n            main.title.size = 1,) +\n  tm_borders(alpha = 0.5) +\n  tm_scale_bar() +\n  tm_grid(alpha = 0.2) +\ntm_shape(mpsz2019) +\n  tm_polygons(alpha = 0) +\n  tm_borders(alpha = 0.1) \n```\n\n::: {.cell-output-display}\n![](Take_home_Ex01_files/figure-html/unnamed-chunk-35-1.png){width=672}\n:::\n:::\n\n\nBy overlaying the mpsz2019 planning subzone polygons over the hexagon layer, we can obtain a clearer visualisation of where most of high ridership numbers originate from during morning peak period.\n\nMost of the high trip numbers occur in hexagon grids that occur in residential areas such as Toh Guan, Redhill, and Hougang. In contrast, the lowest trip numbers are observed in the city and industrial areas such as Tuas, Lim Chu Kang, and Changi West. Interestingly, there are some residential areas with lower observed trip numbers such as Serangoon Garden and Holland Road. This could be due to the higher presence of landed property in these estates, which is likely correlated to higher likelihood of car ownership. It can also be observed that there is one hexagon grid next to the Tuas checkpoint that has high trips recorded.\n\n### 4.2.2. Weekday PM Peak Hours (by Origin)\n\n\n::: {.cell}\n\n```{.r .cell-code}\ntmap_mode('plot')\ntm_shape(WD_PM_map) +\n  tm_fill(\"TRIPS\",\n          style = \"quantile\",\n          palette = \"Greens\",\n          id = \"TRIPS\") +\n  tm_layout(main.title = \"Trips by Origin on Weekday PM Peak Hours\",\n            main.title.position = \"center\",\n            main.title.size = 1,) +\n  tm_borders(alpha = 0.5) +\n  tm_scale_bar() +\n  tm_grid(alpha = 0.2) +\ntm_shape(mpsz2019) +\n  tm_polygons(alpha = 0) +\n  tm_borders(alpha = 0.1) \n```\n\n::: {.cell-output-display}\n![](Take_home_Ex01_files/figure-html/unnamed-chunk-36-1.png){width=672}\n:::\n:::\n\n\nFrom the visualisation above, we can observe the highest trip numbers in the southern region of Singapore, where a cluster of dark green hexagons are seen. This falls within the Chinatown, City Hall and Bugis subzones, where many workplaces are located. Higher trip numbers originating from these areas are expected during PM peak hours as that is when most people end work. Bus trips originating from residential areas appear to be lower during this period. Interestingly, even though many workplaces can be found in Tuas, low bus trip numbers are recorded during Weekday evening peak periods. This could be due to the provision of company transport for employees working in Tuas.\n\n### 4.2.3. Weekend/Holiday AM Peak Hours (by Origin)\n\n\n::: {.cell}\n\n```{.r .cell-code}\ntmap_mode(\"plot\")\ntm_shape(WE_AM_map) +\n  tm_fill(\"TRIPS\",\n          style = \"quantile\",\n          palette = \"Reds\",\n          id =  \"TRIPS\") +\n  tm_layout(main.title = \"Trips by Origin on Weekend/Holidays AM Peak Hours\",\n            main.title.position = \"center\",\n            main.title.size = 1,) +\n  tm_borders(alpha = 0.5) +\n  tm_scale_bar() +\n  tm_grid(alpha = 0.2) +\ntm_shape(mpsz2019) +\n  tm_polygons(alpha = 0) +\n  tm_borders(alpha = 0.1) +\n  tm_grid(alpha = 0.2)\n```\n\n::: {.cell-output-display}\n![](Take_home_Ex01_files/figure-html/unnamed-chunk-37-1.png){width=672}\n:::\n:::\n\n\nFrom the visualisation, high trip numbers can be observed to be occuring throughout Singapore on Weekend/Holiday morning peak periods, except in the western region of Joo Koon and Tuas. Some individual hexagon points that recorded high bus trips occur at the Turf Club, Changi Point, and Changi Airport. Many of the high trip numbers are recorded in the city area around Chinatown, Raffles Place, and Dhoby Ghaut. Low bus trip numbers are recorded in areas such as Lim Chu Kang, one-north, and Xilin.\n\n### 4.2.4. Weekend PM Peak Hours (by Origin)\n\n\n::: {.cell}\n\n```{.r .cell-code}\ntmap_mode(\"plot\")\ntm_shape(WE_PM_map) +\n  tm_fill(\"TRIPS\",\n          style = \"quantile\",\n          palette = \"Oranges\",\n          id = \"TRIPS\") +\n  tm_layout(main.title = \"Trips by Origin on Weekend/Holidays PM Peak Hours\",\n            main.title.position = \"center\",\n            main.title.size = 1,) +\n  tm_borders(alpha = 0.5) +\n  tm_scale_bar() +\n  tm_grid(alpha = 0.2) +\ntm_shape(mpsz2019) +\n  tm_polygons(alpha = 0) +\n  tm_borders(alpha = 0.05) \n```\n\n::: {.cell-output-display}\n![](Take_home_Ex01_files/figure-html/unnamed-chunk-38-1.png){width=672}\n:::\n:::\n\n\nFrom the visualisation, high trip numbers can be observed to be occuring at different areas in Singapore on Weekend/Holiday evening peak periods. The western region of Joo Koon and Tuas remains relatively quiet with generally low bus trips recorded. Some individual hexagon points that recorded high bus trips occur at the Turf Club, Central Water Catchment, Changi Point and Changi Airport. Many of the high trip numbers are clustered around the city area around Chinatown, Raffles Place, and Dhoby Ghaut. Low bus trip numbers are recorded in areas such as Lim Chu Kang, Kranji, one-north, and Xilin.\n\n### 4.2.3. Comparison\n\n\n::: {.cell}\n\n```{.r .cell-code  code-fold=\"true\" code-summary=\"Show the code\"}\ntmap_mode(\"plot\")\nWD_AM_plot <- tm_shape(WD_AM_map) +\n  tm_fill(\"TRIPS\",\n          style = \"quantile\",\n          palette = \"Blues\",\n          id = \"TRIPS\") +\n  tm_layout(main.title = \"Weekday AM Peak Hours\",\n            main.title.position = \"center\",\n            main.title.size = 1,\n            legend.height = 0.45,\n            legend.width = 0.35,) +\n  tm_borders(alpha = 0.5) +\n  tm_scale_bar() +\n  tm_grid(alpha = 0.2)\n\nWD_PM_plot <- tm_shape(WD_PM_map) +\n  tm_fill(\"TRIPS\",\n          style = \"quantile\",\n          palette = \"Greens\",\n          id = \"TRIPS\") +\n  tm_layout(main.title = \"Weekday PM Peak Hours\",\n            main.title.position = \"center\",\n            main.title.size = 1,\n            legend.height = 0.45,\n            legend.width = 0.35,) +\n  tm_borders(alpha = 0.5) +\n  tm_scale_bar() +\n  tm_grid(alpha = 0.2)\n\nWE_AM_plot <- tm_shape(WE_AM_map) +\n  tm_fill(\"TRIPS\",\n          style = \"quantile\",\n          palette = \"Reds\",\n          id =  \"TRIPS\") +\n  tm_layout(main.title = \"Weekend/Holidays AM Peak Hours\",\n            main.title.position = \"center\",\n            main.title.size = 1,\n            legend.height = 0.45,\n            legend.width = 0.35,) +\n  tm_borders(alpha = 0.5) +\n  tm_scale_bar() +\n  tm_grid(alpha = 0.2)\n\nWE_PM_plot <- tm_shape(WE_PM_map) +\n  tm_fill(\"TRIPS\",\n          style = \"quantile\",\n          palette = \"Oranges\",\n          id = \"TRIPS\") +\n  tm_layout(main.title = \"Weekend/Holidays PM Peak Hours\",\n            main.title.position = \"center\",\n            main.title.size = 1,\n            legend.height = 0.45,\n            legend.width = 0.35,) +\n  tm_borders(alpha = 0.5) +\n  tm_scale_bar() +\n  tm_grid(alpha = 0.2)\n\ntmap_arrange(WD_AM_plot, WD_PM_plot, \n             WE_AM_plot, WE_PM_plot, \n             asp = 2, ncol = 2)\n```\n\n::: {.cell-output-display}\n![](Take_home_Ex01_files/figure-html/unnamed-chunk-39-1.png){width=672}\n:::\n:::\n\n\nPlotting all four graphs together allows for easier comparison.\n\nFirst, comparing weekday morning and weekday evening trips, it is observed the the much higher highest trip number (569,969) is recorded in the evening as compared to in the morning (327,930). On the western, northern, and north-eastern ends, we can see that there are more grids with a higher number of trips recorded in the morning than in the evening. In contrast, more trips are recorded in the evening in the southern and city areas than in the morning.\n\nNext, comparing weekend morning and weekend evening trips, visually, the distribution looks rather similar.\n\nNext, comparing weekday morning and weekend morning trips, more trips are observed to originate from the city area on weekends than on weekdays.\n\nLastly, comparing weekday evening and weekend evening trips, a slightly higher number of trips originating from the city area is observed on weekends than on weekdays. It also appears that slightly more trips originate from the eastern area of Singapore on weekends than on weekday evenings.\n\n# 5. Local Indicators of Spatial Association (LISA) Analysis\n\nLocal Indicators of Spatial Association (LISA) evaluates the existence of clusters in the spatial arrangement of a given variable. We will apply the appropriate LISA methods to detect cluster and/or outlier from bus ridership by origin bus stop in Singapore.\n\n## 5.1. Preparing Data\n\nFirst, we will prepare the datasets to be used for LISA analysis. This is because the original dataset used for mapping contained NA values in order for all hexagon grids to be shown on the map. We will use `drop_na()` to remove the NA values from the datasets.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nWD_AM_lisa <- WD_AM_map %>%\n  ungroup() %>%\n  drop_na()\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nWD_PM_lisa <- WD_PM_map %>%\n  ungroup() %>%\n  drop_na()\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nWE_AM_lisa <- WE_AM_map %>%\n  ungroup() %>%\n  drop_na()\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nWE_PM_lisa <- WE_PM_map %>%\n  ungroup() %>%\n  drop_na()\n```\n:::\n\n\n## 5.2. Visualising the Data\n\n### 5.2.1. Weekday AM Peak Hours (by Origin)\n\nUsing the weekday morning peak period data as an example, we use `qtm()` to do a quick plot for visualisation purposes.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nqtm(WD_AM_lisa)\n```\n\n::: {.cell-output-display}\n![](Take_home_Ex01_files/figure-html/unnamed-chunk-44-1.png){width=672}\n:::\n:::\n\n\nFrom the plot above, it is observed that there are many hexagon areas without neighbours after applying `drop_na()`. This is likely the same case with the remaining three datasets:\n\n### 5.2.2. Weekday PM Peak Hours (by Origin)\n\n\n::: {.cell}\n\n```{.r .cell-code}\nqtm(WD_PM_lisa)\n```\n\n::: {.cell-output-display}\n![](Take_home_Ex01_files/figure-html/unnamed-chunk-45-1.png){width=672}\n:::\n:::\n\n\n### 5.2.3. Weekend AM Peak Hours (by Origin)\n\n\n::: {.cell}\n\n```{.r .cell-code}\nqtm(WE_AM_lisa)\n```\n\n::: {.cell-output-display}\n![](Take_home_Ex01_files/figure-html/unnamed-chunk-46-1.png){width=672}\n:::\n:::\n\n\n### 5.2.4. Weekend PM Peak Hours (by Origin)\n\n\n::: {.cell}\n\n```{.r .cell-code}\nqtm(WE_PM_lisa)\n```\n\n::: {.cell-output-display}\n![](Take_home_Ex01_files/figure-html/unnamed-chunk-47-1.png){width=672}\n:::\n:::\n\n\n## 5.3. Deriving Spatial Weights and Local Moran's I\n\nBased on the visualisations above, we will use inverse distance weights (IDW) method to derive the spatial weights for each dataset. IDW assumes that each measured point has a local influence that diminishes with distance. It gives greater weights to points closest to the prediction location, and the weights diminish as a function of distance[^3].\n\n[^3]: https://pro.arcgis.com/en/pro-app/latest/help/analysis/geostatistical-analyst/how-inverse-distance-weighted-interpolation-works.htm\n\n### 5.3.1. Weekday AM Peak Hours (by Origin)\n\n\n::: {.cell}\n\n```{.r .cell-code}\nWD_AM_idw <- WD_AM_lisa %>%\n  mutate(nb = st_knn(geometry, k=8),\n         wt = st_inverse_distance(nb, geometry,\n                                   scale = 1,\n                                   alpha = 1),\n         .before = 1)\nWD_AM_idw\n```\n\n::: {.cell-output .cell-output-stdout}\n```\nSimple feature collection with 1119 features and 4 fields\nGeometry type: POLYGON\nDimension:     XY\nBounding box:  xmin: 3822.239 ymin: 27415.39 xmax: 48855.56 ymax: 50082.05\nProjected CRS: SVY21 / Singapore TM\n# A tibble: 1,119 × 5\n   nb        wt        id    TRIPS                                      geometry\n * <nb>      <list>    <fct> <dbl>                                 <POLYGON [m]>\n 1 <int [8]> <dbl [8]> 223     103 ((4110.914 27915.39, 3822.239 28082.05, 3822…\n 2 <int [8]> <dbl [8]> 259      52 ((4399.589 28415.39, 4110.914 28582.05, 4110…\n 3 <int [8]> <dbl [8]> 261      78 ((4399.589 30415.39, 4110.914 30582.05, 4110…\n 4 <int [8]> <dbl [8]> 295    1367 ((4688.264 29915.39, 4399.589 30082.05, 4399…\n 5 <int [8]> <dbl [8]> 296      53 ((4688.264 30915.39, 4399.589 31082.05, 4399…\n 6 <int [8]> <dbl [8]> 329     185 ((4976.939 28415.39, 4688.264 28582.05, 4688…\n 7 <int [8]> <dbl [8]> 330     152 ((4976.939 29415.39, 4688.264 29582.05, 4688…\n 8 <int [8]> <dbl [8]> 331    1034 ((4976.939 30415.39, 4688.264 30582.05, 4688…\n 9 <int [8]> <dbl [8]> 332      60 ((4976.939 31415.39, 4688.264 31582.05, 4688…\n10 <int [8]> <dbl [8]> 333     399 ((4976.939 32415.39, 4688.264 32582.05, 4688…\n# ℹ 1,109 more rows\n```\n:::\n:::\n\n\nUsing IDW, we will compute Local Moran's I on `TRIPS` based on 100 simulations for each study period. The code uses the `local_moran()` function from the `sfdep` package:\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlisa_WD_AM <- WD_AM_idw %>%\n  mutate(local_moran = local_moran(TRIPS, nb, wt, nsim = 99),\n         .before = 1) %>%\n  unnest(local_moran)\nlisa_WD_AM\n```\n\n::: {.cell-output .cell-output-stdout}\n```\nSimple feature collection with 1119 features and 16 fields\nGeometry type: POLYGON\nDimension:     XY\nBounding box:  xmin: 3822.239 ymin: 27415.39 xmax: 48855.56 ymax: 50082.05\nProjected CRS: SVY21 / Singapore TM\n# A tibble: 1,119 × 17\n        ii      eii  var_ii  z_ii   p_ii p_ii_sim p_folded_sim skewness kurtosis\n     <dbl>    <dbl>   <dbl> <dbl>  <dbl>    <dbl>        <dbl>    <dbl>    <dbl>\n 1 0.00300 -1.28e-5 3.23e-6  1.68 0.0938     0.02         0.01   -2.15    6.83  \n 2 0.00402  2.57e-4 4.01e-6  1.88 0.0602     0.02         0.01   -0.512  -0.397 \n 3 0.00481 -1.32e-4 6.24e-6  1.98 0.0478     0.02         0.01   -1.66    5.95  \n 4 0.00498 -3.49e-4 7.92e-6  1.89 0.0584     0.02         0.01   -0.933   0.741 \n 5 0.00532 -4.97e-4 1.10e-5  1.75 0.0795     0.02         0.01   -1.83    4.95  \n 6 0.00474 -1.65e-4 6.83e-6  1.88 0.0606     0.02         0.01   -1.49    3.44  \n 7 0.00498 -1.27e-4 7.23e-6  1.90 0.0575     0.02         0.01   -0.917   1.06  \n 8 0.00585 -1.17e-4 9.17e-6  1.97 0.0488     0.02         0.01   -1.06    1.24  \n 9 0.00540 -6.43e-4 8.18e-6  2.11 0.0346     0.02         0.01   -0.646   0.0101\n10 0.00460  1.38e-4 4.52e-6  2.10 0.0359     0.02         0.01   -0.302  -0.277 \n# ℹ 1,109 more rows\n# ℹ 8 more variables: mean <fct>, median <fct>, pysal <fct>, nb <nb>,\n#   wt <list>, id <fct>, TRIPS <dbl>, geometry <POLYGON [m]>\n```\n:::\n:::\n\n\nWe will repeat the above steps for the remaining datasets:\n\n### 5.3.2. Weekday PM Peak Hours (by Origin)\n\n\n::: {.cell}\n\n```{.r .cell-code}\nWD_PM_idw <- WD_PM_lisa %>%\n  mutate(nb = st_knn(geometry, k=8),\n         wt = st_inverse_distance(nb, geometry,\n                                   scale = 1,\n                                   alpha = 1),\n         .before = 1)\nWD_PM_idw\n```\n\n::: {.cell-output .cell-output-stdout}\n```\nSimple feature collection with 1127 features and 4 fields\nGeometry type: POLYGON\nDimension:     XY\nBounding box:  xmin: 3822.239 ymin: 27415.39 xmax: 48855.56 ymax: 50082.05\nProjected CRS: SVY21 / Singapore TM\n# A tibble: 1,127 × 5\n   nb        wt        id    TRIPS                                      geometry\n * <nb>      <list>    <fct> <dbl>                                 <POLYGON [m]>\n 1 <int [8]> <dbl [8]> 223     390 ((4110.914 27915.39, 3822.239 28082.05, 3822…\n 2 <int [8]> <dbl [8]> 259     114 ((4399.589 28415.39, 4110.914 28582.05, 4110…\n 3 <int [8]> <dbl [8]> 261     291 ((4399.589 30415.39, 4110.914 30582.05, 4110…\n 4 <int [8]> <dbl [8]> 295    3196 ((4688.264 29915.39, 4399.589 30082.05, 4399…\n 5 <int [8]> <dbl [8]> 296     241 ((4688.264 30915.39, 4399.589 31082.05, 4399…\n 6 <int [8]> <dbl [8]> 329    1905 ((4976.939 28415.39, 4688.264 28582.05, 4688…\n 7 <int [8]> <dbl [8]> 330     583 ((4976.939 29415.39, 4688.264 29582.05, 4688…\n 8 <int [8]> <dbl [8]> 331    2472 ((4976.939 30415.39, 4688.264 30582.05, 4688…\n 9 <int [8]> <dbl [8]> 332     368 ((4976.939 31415.39, 4688.264 31582.05, 4688…\n10 <int [8]> <dbl [8]> 333     114 ((4976.939 32415.39, 4688.264 32582.05, 4688…\n# ℹ 1,117 more rows\n```\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nlisa_WD_PM <- WD_PM_idw %>%\n  mutate(local_moran = local_moran(TRIPS, nb, wt, nsim = 99),\n         .before = 1) %>%\n  unnest(local_moran)\nlisa_WD_PM\n```\n\n::: {.cell-output .cell-output-stdout}\n```\nSimple feature collection with 1127 features and 16 fields\nGeometry type: POLYGON\nDimension:     XY\nBounding box:  xmin: 3822.239 ymin: 27415.39 xmax: 48855.56 ymax: 50082.05\nProjected CRS: SVY21 / Singapore TM\n# A tibble: 1,127 × 17\n        ii      eii  var_ii  z_ii   p_ii p_ii_sim p_folded_sim skewness kurtosis\n     <dbl>    <dbl>   <dbl> <dbl>  <dbl>    <dbl>        <dbl>    <dbl>    <dbl>\n 1 0.00199 -9.06e-7 2.08e-6  1.38 0.168      0.02         0.01   -2.92   13.1   \n 2 0.00267  3.66e-5 2.33e-6  1.73 0.0843     0.02         0.01   -0.937   0.0439\n 3 0.00313 -2.17e-4 8.00e-6  1.18 0.236      0.02         0.01   -3.26   13.8   \n 4 0.00297  4.38e-5 3.33e-6  1.61 0.108      0.02         0.01   -1.80    3.82  \n 5 0.00348  1.82e-4 3.36e-6  1.80 0.0722     0.02         0.01   -1.02    0.591 \n 6 0.00295 -4.16e-4 4.52e-6  1.58 0.114      0.02         0.01   -1.95    4.91  \n 7 0.00320  2.35e-4 3.96e-6  1.49 0.136      0.02         0.01   -2.07    5.76  \n 8 0.00358  2.93e-4 4.07e-6  1.63 0.103      0.02         0.01   -1.37    2.20  \n 9 0.00349 -2.97e-4 6.87e-6  1.45 0.148      0.02         0.01   -1.78    3.48  \n10 0.00307 -6.52e-5 4.02e-6  1.56 0.118      0.02         0.01   -1.75    3.17  \n# ℹ 1,117 more rows\n# ℹ 8 more variables: mean <fct>, median <fct>, pysal <fct>, nb <nb>,\n#   wt <list>, id <fct>, TRIPS <dbl>, geometry <POLYGON [m]>\n```\n:::\n:::\n\n\n### 5.3.3. Weekend AM Peak Hours (by Origin)\n\n\n::: {.cell}\n\n```{.r .cell-code}\nWE_AM_idw <- WE_AM_lisa %>%\n  mutate(nb = st_knn(geometry, k=8),\n         wt = st_inverse_distance(nb, geometry,\n                                   scale = 1,\n                                   alpha = 1),\n         .before = 1)\nWE_AM_idw\n```\n\n::: {.cell-output .cell-output-stdout}\n```\nSimple feature collection with 1107 features and 4 fields\nGeometry type: POLYGON\nDimension:     XY\nBounding box:  xmin: 4110.914 ymin: 27415.39 xmax: 48855.56 ymax: 50082.05\nProjected CRS: SVY21 / Singapore TM\n# A tibble: 1,107 × 5\n   nb        wt        id    TRIPS                                      geometry\n * <nb>      <list>    <fct> <dbl>                                 <POLYGON [m]>\n 1 <int [8]> <dbl [8]> 259      26 ((4399.589 28415.39, 4110.914 28582.05, 4110…\n 2 <int [8]> <dbl [8]> 261      52 ((4399.589 30415.39, 4110.914 30582.05, 4110…\n 3 <int [8]> <dbl [8]> 295     494 ((4688.264 29915.39, 4399.589 30082.05, 4399…\n 4 <int [8]> <dbl [8]> 296      76 ((4688.264 30915.39, 4399.589 31082.05, 4399…\n 5 <int [8]> <dbl [8]> 329     187 ((4976.939 28415.39, 4688.264 28582.05, 4688…\n 6 <int [8]> <dbl [8]> 330      68 ((4976.939 29415.39, 4688.264 29582.05, 4688…\n 7 <int [8]> <dbl [8]> 331     691 ((4976.939 30415.39, 4688.264 30582.05, 4688…\n 8 <int [8]> <dbl [8]> 332      45 ((4976.939 31415.39, 4688.264 31582.05, 4688…\n 9 <int [8]> <dbl [8]> 333      26 ((4976.939 32415.39, 4688.264 32582.05, 4688…\n10 <int [8]> <dbl [8]> 364      21 ((5265.614 28915.39, 4976.939 29082.05, 4976…\n# ℹ 1,097 more rows\n```\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nlisa_WE_AM <- WE_AM_idw %>%\n  mutate(local_moran = local_moran(TRIPS, nb, wt, nsim = 99),\n         .before = 1) %>%\n  unnest(local_moran)\nlisa_WE_AM\n```\n\n::: {.cell-output .cell-output-stdout}\n```\nSimple feature collection with 1107 features and 16 fields\nGeometry type: POLYGON\nDimension:     XY\nBounding box:  xmin: 4110.914 ymin: 27415.39 xmax: 48855.56 ymax: 50082.05\nProjected CRS: SVY21 / Singapore TM\n# A tibble: 1,107 × 17\n        ii      eii  var_ii  z_ii   p_ii p_ii_sim p_folded_sim skewness kurtosis\n     <dbl>    <dbl>   <dbl> <dbl>  <dbl>    <dbl>        <dbl>    <dbl>    <dbl>\n 1 0.00295  2.90e-5 2.29e-6  1.93 0.0535     0.02         0.01   -1.38     3.04 \n 2 0.00415  2.84e-4 4.89e-6  1.75 0.0806     0.02         0.01   -1.16     1.56 \n 3 0.00427 -8.35e-5 5.57e-6  1.84 0.0653     0.02         0.01   -0.910    0.487\n 4 0.00454 -3.36e-4 7.73e-6  1.75 0.0798     0.02         0.01   -1.33     1.77 \n 5 0.00387 -6.59e-4 6.46e-6  1.78 0.0745     0.02         0.01   -1.34     2.53 \n 6 0.00436  4.02e-4 4.43e-6  1.88 0.0599     0.02         0.01   -0.624   -0.201\n 7 0.00476  6.16e-6 5.71e-6  1.99 0.0465     0.02         0.01   -0.972    0.742\n 8 0.00460 -1.19e-4 5.06e-6  2.10 0.0358     0.02         0.01   -1.19     1.15 \n 9 0.00376  4.06e-4 4.06e-6  1.66 0.0965     0.04         0.02   -0.817    0.704\n10 0.00466 -3.95e-4 9.31e-6  1.66 0.0974     0.02         0.01   -1.31     1.93 \n# ℹ 1,097 more rows\n# ℹ 8 more variables: mean <fct>, median <fct>, pysal <fct>, nb <nb>,\n#   wt <list>, id <fct>, TRIPS <dbl>, geometry <POLYGON [m]>\n```\n:::\n:::\n\n\n### 5.3.4. Weekend PM Peak Hours (by Origin)\n\n\n::: {.cell}\n\n```{.r .cell-code}\nWE_PM_idw <- WE_PM_lisa %>%\n  mutate(nb = st_knn(geometry, k=8),\n         wt = st_inverse_distance(nb, geometry,\n                                   scale = 1,\n                                   alpha = 1),\n         .before = 1)\nWE_PM_idw\n```\n\n::: {.cell-output .cell-output-stdout}\n```\nSimple feature collection with 1109 features and 4 fields\nGeometry type: POLYGON\nDimension:     XY\nBounding box:  xmin: 3822.239 ymin: 27415.39 xmax: 48855.56 ymax: 50082.05\nProjected CRS: SVY21 / Singapore TM\n# A tibble: 1,109 × 5\n   nb        wt        id    TRIPS                                      geometry\n * <nb>      <list>    <fct> <dbl>                                 <POLYGON [m]>\n 1 <int [8]> <dbl [8]> 223      56 ((4110.914 27915.39, 3822.239 28082.05, 3822…\n 2 <int [8]> <dbl [8]> 259      14 ((4399.589 28415.39, 4110.914 28582.05, 4110…\n 3 <int [8]> <dbl [8]> 261     100 ((4399.589 30415.39, 4110.914 30582.05, 4110…\n 4 <int [8]> <dbl [8]> 295     766 ((4688.264 29915.39, 4399.589 30082.05, 4399…\n 5 <int [8]> <dbl [8]> 296      55 ((4688.264 30915.39, 4399.589 31082.05, 4399…\n 6 <int [8]> <dbl [8]> 329     346 ((4976.939 28415.39, 4688.264 28582.05, 4688…\n 7 <int [8]> <dbl [8]> 330     122 ((4976.939 29415.39, 4688.264 29582.05, 4688…\n 8 <int [8]> <dbl [8]> 331    1030 ((4976.939 30415.39, 4688.264 30582.05, 4688…\n 9 <int [8]> <dbl [8]> 332      49 ((4976.939 31415.39, 4688.264 31582.05, 4688…\n10 <int [8]> <dbl [8]> 333     153 ((4976.939 32415.39, 4688.264 32582.05, 4688…\n# ℹ 1,099 more rows\n```\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nlisa_WE_PM <- WE_PM_idw %>%\n  mutate(local_moran = local_moran(TRIPS, nb, wt, nsim = 99),\n         .before = 1) %>%\n  unnest(local_moran)\nlisa_WE_PM\n```\n\n::: {.cell-output .cell-output-stdout}\n```\nSimple feature collection with 1109 features and 16 fields\nGeometry type: POLYGON\nDimension:     XY\nBounding box:  xmin: 3822.239 ymin: 27415.39 xmax: 48855.56 ymax: 50082.05\nProjected CRS: SVY21 / Singapore TM\n# A tibble: 1,109 × 17\n        ii      eii  var_ii  z_ii   p_ii p_ii_sim p_folded_sim skewness kurtosis\n     <dbl>    <dbl>   <dbl> <dbl>  <dbl>    <dbl>        <dbl>    <dbl>    <dbl>\n 1 0.00205  4.91e-5 2.05e-6  1.40 0.162      0.02         0.01    -1.75     3.50\n 2 0.00276  6.42e-6 2.33e-6  1.81 0.0709     0.02         0.01    -1.14     1.10\n 3 0.00318 -1.06e-4 4.84e-6  1.49 0.135      0.02         0.01    -1.84     4.12\n 4 0.00315 -3.58e-4 6.45e-6  1.38 0.167      0.02         0.01    -1.83     3.31\n 5 0.00351 -1.12e-4 9.42e-6  1.18 0.238      0.02         0.01    -2.92    10.3 \n 6 0.00311  4.97e-4 2.31e-6  1.72 0.0860     0.02         0.01    -1.71     5.05\n 7 0.00335  2.37e-4 3.81e-6  1.59 0.111      0.02         0.01    -1.96     6.53\n 8 0.00347 -5.84e-4 7.61e-6  1.47 0.142      0.02         0.01    -1.97     5.01\n 9 0.00358  2.40e-4 4.40e-6  1.59 0.111      0.02         0.01    -2.21     8.54\n10 0.00284  4.73e-6 4.07e-6  1.41 0.160      0.02         0.01    -1.73     4.48\n# ℹ 1,099 more rows\n# ℹ 8 more variables: mean <fct>, median <fct>, pysal <fct>, nb <nb>,\n#   wt <list>, id <fct>, TRIPS <dbl>, geometry <POLYGON [m]>\n```\n:::\n:::\n\n\n## 5.4. Visualising LISA\n\nLastly, we will visualise the results of the LISA analysis on choropleth maps. A LISA map is a categorical map showing outliers and clusters. There are two types of outliers, High-Low and Low-High, and two types of clusters, **High-High** and **Low-Low**. LISA map is an interpreted map by combining local Moran's I of geographical areas and their respective p-values.\n\nOne map will be plotted for each study period, and each map will only display significant associations (i.e. p-value \\< 0.05).\n\n### 5.4.1. Weekday AM Peak Hours (by Origin)\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlisa_WD_AM_sig <- lisa_WD_AM  %>%\n  filter(p_ii_sim < 0.05)\n\ntmap_mode(\"plot\")\ntm_shape(hexagon) + \n  tm_fill(alpha = 0.1) +\n  tm_borders(alpha = 0.1) +\ntm_shape(lisa_WD_AM) +\n  tm_polygons() +\n  tm_borders(alpha = 0.5) +\ntm_shape(lisa_WD_AM_sig) +\n  tm_fill(\"mean\") + \n  tm_borders(alpha = 0.4) +\n  tm_layout(main.title = \"LISA Analysis of Trips During Weekday AM Peak (by Origin)\",\n            main.title.position = \"center\",\n            main.title.size = 1) +\n  tm_scale_bar() +\n  tm_grid(alpha = 0.2)\n```\n\n::: {.cell-output-display}\n![](Take_home_Ex01_files/figure-html/unnamed-chunk-56-1.png){width=672}\n:::\n:::\n\n\nIt is observed from the visualisation that most of the associations are not considered significant (p-value greater than 0.05) as they are represented by grey hexagons.\n\nWe can observe that there are more Low-Low clusters than High-High clusters. Most of the Low-Low clusters occur in the Tuas, Lim Chu Kang, Mandai, Marina Bay, and Changi areas. The High-High clusters appear in residential areas such as Woodlands, Choa Chu Kang, Punggol, and Serangoon.\n\nHowever, there are some High-Low and Low-High outliers that are observed. Some of the High-Low outliers are observed near the Low-Low clusters in the Tuas and Mandai areas. There are also Low-High outliers found in the residential areas such as Jurong, Woodlands, and Ang Mo Kio.\n\n### 5.4.2. Weekday PM Peak Hours (by Origin)\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlisa_WD_PM_sig <- lisa_WD_PM  %>%\n  filter(p_ii_sim < 0.05)\n\ntmap_mode(\"plot\")\ntm_shape(hexagon) + \n  tm_fill(alpha = 0.1) +\n  tm_borders(alpha = 0.1) +\ntm_shape(lisa_WD_PM) +\n  tm_polygons() +\n  tm_borders(alpha = 0.5) +\ntm_shape(lisa_WD_PM_sig) +\n  tm_fill(\"mean\") + \n  tm_borders(alpha = 0.4)+\n  tm_layout(main.title = \"LISA Analysis of Trips During Weekday PM Peak (by Origin)\",\n            main.title.position = \"center\",\n            main.title.size = 1) +\n  tm_scale_bar() +\n  tm_grid(alpha = 0.2)\n```\n\n::: {.cell-output-display}\n![](Take_home_Ex01_files/figure-html/unnamed-chunk-57-1.png){width=672}\n:::\n:::\n\n\nIt is observed from the visualisation that most of the associations are not considered significant (p-value greater than 0.05) as they are represented by grey hexagons.\n\nWe can observe that there are more Low-Low clusters than High-High clusters. Most of the Low-Low clusters occur in the Tuas, Lim Chu Kang, Mandai, and Tampines areas. The High-High clusters appear in some residential areas such as Clementi, Ang Mo Kio, and Tampines areas. Some High-High clusters are also observed in the city area around Bugis.\n\nHowever, there are some High-Low and Low-High outliers that are observed. Some of the High-Low outliers are observed near the Low-Low clusters in Tuas, Mandai, and Seletar areas. There are also Low-High outliers found in the residential areas such as Jurong, Kranji, Woodlands, and Ang Mo Kio.\n\n### 5.4.3. Weekend AM Peak Hours (by Origin)\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlisa_WE_AM_sig <- lisa_WE_AM  %>%\n  filter(p_ii_sim < 0.05)\n\ntmap_mode(\"plot\")\ntm_shape(hexagon) + \n  tm_fill(alpha = 0.1) +\n  tm_borders(alpha = 0.1) +\ntm_shape(lisa_WE_AM) +\n  tm_polygons() +\n  tm_borders(alpha = 0.5) +\ntm_shape(lisa_WE_AM_sig) +\n  tm_fill(\"mean\") + \n  tm_borders(alpha = 0.4)+\n  tm_layout(main.title = \"LISA Analysis of Trips During Weekend AM Peak (by Origin)\",\n            main.title.position = \"center\",\n            main.title.size = 1) +\n  tm_scale_bar() +\n  tm_grid(alpha = 0.2)\n```\n\n::: {.cell-output-display}\n![](Take_home_Ex01_files/figure-html/unnamed-chunk-58-1.png){width=672}\n:::\n:::\n\n\nIt is observed from the visualisation that most of the associations are not considered significant (p-value greater than 0.05) as they are represented by grey hexagons.\n\nWe can observe that there are more Low-Low clusters than High-High clusters. Most of the Low-Low clusters occur in the Tuas, Lim Chu Kang, Mandai, Seletar, Tampines, and Changi areas. The High-High clusters appear in residential areas such as Clementi, Bukit Batok, Choa Chu Kang, Punggol, and Serangoon. Some High-High clusters are also observed in the city area around Bugis.\n\nHowever, there are some High-Low and Low-High outliers that are observed, although they appear more sporadic. Some of the High-Low outliers are observed near the Low-Low clusters in the Tuas, Mandai, and Seletar areas. There are also Low-High outliers found in the residential areas such as Jurong, Choa Chu Kang, Woodlands, and Ang Mo Kio. Some Low-High outliers are also observed near High-High clusters in the city area.\n\n### 5.4.4. Weekend PM Peak Hours (by Origin)\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlisa_WE_PM_sig <- lisa_WE_PM  %>%\n  filter(p_ii_sim < 0.05)\n\ntmap_mode(\"plot\")\ntm_shape(hexagon) + \n  tm_fill(alpha = 0.1) +\n  tm_borders(alpha = 0.1) +\ntm_shape(lisa_WE_PM) +\n  tm_polygons() +\n  tm_borders(alpha = 0.5) +\ntm_shape(lisa_WE_PM_sig) +\n  tm_fill(\"mean\") + \n  tm_borders(alpha = 0.4)+\n  tm_layout(main.title = \"LISA Analysis of Trips During Weekend AM Peak (by Origin)\",\n            main.title.position = \"center\",\n            main.title.size = 1) +\n  tm_scale_bar() +\n  tm_grid(alpha = 0.2)\n```\n\n::: {.cell-output-display}\n![](Take_home_Ex01_files/figure-html/unnamed-chunk-59-1.png){width=672}\n:::\n:::\n\n\nIt is observed from the visualisation that most of the associations are not considered significant (p-value greater than 0.05) as they are represented by grey hexagons.\n\nWe can observe that there are more Low-Low clusters than High-High clusters. Most of the Low-Low clusters occur in the Tuas, Lim Chu Kang, Mandai, and Tampines areas. The High-High clusters appear in some residential areas such as Clementi, Ang Mo Kio, and Tampines areas. Some High-High clusters are also observed in the city area around Bugis.\n\nHowever, there are some High-Low and Low-High outliers that are observed. Some of the High-Low outliers are observed near the Low-Low clusters in Tuas, Mandai, and Seletar areas. There are also Low-High outliers found in the residential areas such as Clementi, Choa Chu Kang, Woodlands, and Ang Mo Kio. Some Low-High outliers are also observed near the High-High clusters in the city area.\n\n### 5.4.5. Comparison\n\n\n::: {.cell}\n\n```{.r .cell-code  code-fold=\"true\" code-summary=\"Show the code\"}\ntmap_mode(\"plot\")\nlisa_WD_AM_plot <- tm_shape(hexagon) + \n  tm_fill(alpha = 0.1) +\n  tm_borders(alpha = 0.1) +\ntm_shape(lisa_WD_AM) +\n  tm_polygons() +\n  tm_borders(alpha = 0.5) +\ntm_shape(lisa_WD_AM_sig) +\n  tm_fill(\"mean\") + \n  tm_borders(alpha = 0.4) +\n  tm_layout(main.title = \"Weekday AM Peak\",\n            main.title.position = \"center\",\n            main.title.size = 1,\n            legend.height = 0.45,\n            legend.width = 0.35,) +\n  tm_scale_bar() +\n  tm_grid(alpha = 0.2)\n\nlisa_WD_PM_plot <- tm_shape(hexagon) + \n  tm_fill(alpha = 0.1) +\n  tm_borders(alpha = 0.1) +\ntm_shape(lisa_WD_PM) +\n  tm_polygons() +\n  tm_borders(alpha = 0.5) +\ntm_shape(lisa_WD_PM_sig) +\n  tm_fill(\"mean\") + \n  tm_borders(alpha = 0.4)+\n  tm_layout(main.title = \"Weekday PM Peak\",\n            main.title.position = \"center\",\n            main.title.size = 1,\n            legend.height = 0.45,\n            legend.width = 0.35,) +\n  tm_scale_bar() +\n  tm_grid(alpha = 0.2)\n\n  \nlisa_WE_AM_plot <- tm_shape(hexagon) + \n  tm_fill(alpha = 0.1) +\n  tm_borders(alpha = 0.1) +\ntm_shape(lisa_WE_AM) +\n  tm_polygons() +\n  tm_borders(alpha = 0.5) +\ntm_shape(lisa_WE_AM_sig) +\n  tm_fill(\"mean\") + \n  tm_borders(alpha = 0.4)+\n  tm_layout(main.title = \"Weekend/Holiday AM Peak\",\n            main.title.position = \"center\",\n            main.title.size = 1,\n            legend.height = 0.45,\n            legend.width = 0.35,) +\n  tm_scale_bar() +\n  tm_grid(alpha = 0.2)\n  \n  \nlisa_WE_PM_plot <- tm_shape(hexagon) + \n  tm_fill(alpha = 0.1) +\n  tm_borders(alpha = 0.1) +\ntm_shape(lisa_WE_PM) +\n  tm_polygons() +\n  tm_borders(alpha = 0.5) +\ntm_shape(lisa_WE_PM_sig) +\n  tm_fill(\"mean\") + \n  tm_borders(alpha = 0.4)+\n  tm_layout(main.title = \"Weekend/Holiday AM Peak\",\n            main.title.position = \"center\",\n            main.title.size = 1,\n            legend.height = 0.45,\n            legend.width = 0.35,) +\n  tm_scale_bar() +\n  tm_grid(alpha = 0.2)\n\ntmap_arrange(lisa_WD_AM_plot, lisa_WD_PM_plot,\n             lisa_WE_AM_plot, lisa_WE_PM_plot,\n             asp = 2, ncol = 2)\n```\n\n::: {.cell-output-display}\n![](Take_home_Ex01_files/figure-html/unnamed-chunk-60-1.png){width=672}\n:::\n:::\n\n\nPlotting all four graphs together allows for easier comparison.\n\nFirstly, the graphs for Weekday AM and Weekday PM are compared. It is observed that there are less Low-Low and High-High clusters occurring in the evening than in the morning. There are more closely situated Low-Low and High-High clusters occurring in the morning than in the evening.\n\nNext, comparing the Weekend AM and Weekend PM graphs, it is observed that there are more Low-Low and High-High clusters occurring in the morning than in the evening. These observations can be seen around Woodlands and Changi for Low-Low clusters and around Clementi and Punggol areas. However, more occurrence of Low-Low clusters is observed in the Lim Chu Kang area in the evening than in the morning.\n\nNext, comparing the Weekday AM and Weekend AM graphs, it is observed that the Low-Low clusters, generally occur in the same locations on weekdays and weekends. There appears to be more closely situated High-High clusters occurring on weekdays than on weekends. High-High clusters in the city most likely occur on weekends only.\n\nLastly, comparing the Weekday PM and Weekend PM graphs, it is observed that the Low-Low clusters generally occur in similar locations on weekdays and weekends. Some slight difference can be observed in the Pasir Panjang region where more Low-Low clusters are observed on weekends than on weekdays. There appears to be more High-High clusters occurring on weekends than on weekdays, especially in the city area.\n",
    "supporting": [
      "Take_home_Ex01_files"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}